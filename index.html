<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Body Pulse V14 - Perfected</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' style='background:%23000000'%3E%3Cpath fill='%23ffffff' d='M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-32.1 289.8l-8.8 45.3c-2.1 10.7-16.5 13.6-22.7 4.6l-37.5-54.6c-5.8-8.4-5.4-19.6 1-27.6l74.9-93.6c7.9-9.9 23.4-4.8 24.3 7.9l3.3 46.1 45.1-66.2c6.1-8.9 19.3-8.6 25 0l42.6 62.4c5.8 8.5 5.2 19.7-1.3 27.6l-81.5 98.7c-8.4 10.2-24.6 4.8-25.3-8.3l-2.6-47.5-36.5 5.2z'/%3E%3C/svg%3E">

    <style>
        /* =========================================
           BASIS STYLES
           ========================================= */
        :root {
            --bg: #000000;
            --surface: #111111;
            --surface-light: #1c1c1e;
            --border: #2c2c2e;
            --primary: #ffffff;
            --accent: #32d74b;
            --blue: #0a84ff;
            --fire: #ff9f0a;
            --secondary: #8e8e93;
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Roboto", sans-serif;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        html, body { 
            position: fixed; 
            overflow: hidden; 
            width: 100%; 
            height: 100%; 
            margin: 0;
            padding: 0;
            touch-action: none;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
            user-select: none; 
        }
        
        body {
            background-color: var(--bg); 
            color: var(--primary); 
            font-family: var(--font);
            display: flex; 
            flex-direction: column;
            padding-top: var(--safe-top);
        }

        /* TYPOGRAPHIE */
        h1 { 
            font-size: 22px; 
            font-weight: 800; 
            margin: 0 0 5px; 
            letter-spacing: 0.5px; 
        }

        h2 { 
            font-size: 11px; 
            font-weight: 700; 
            margin: 0 0 8px; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
            color: var(--secondary); 
        }

        .val-big { 
            font-size: 22px; 
            font-weight: 700; 
            letter-spacing: -0.5px; 
        }
        
        .val-huge {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -1px;
        }

        .label { 
            color: var(--secondary); 
            font-size: 10px; 
            text-transform: uppercase; 
            display: block; 
            margin-bottom: 3px; 
        }

        /* LAYOUT */
        .screen { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
            padding: 15px; 
            padding-bottom: 90px; 
            overflow-y: auto; 
            z-index: 10; 
            position: relative; 
        }

        .screen.active { 
            display: flex; 
            animation: fade 0.3s ease; 
        }
        
        .card { 
            background: var(--surface); 
            padding: 15px; 
            border: 1px solid var(--border); 
            margin-bottom: 8px; 
            border-radius: 14px; 
        }

        .compact-card { 
            padding: 12px; 
            margin-bottom: 6px; 
        }

        .stat-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 10px; 
        }

        .stat-grid-3 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 5px; 
            margin-bottom: 5px; 
        }

        .input-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 10px; 
        }

        /* BUTTONS */
        .btn { 
            width: 100%; 
            padding: 14px; 
            border: none; 
            background: var(--primary); 
            color: var(--bg); 
            font-size: 14px; 
            font-weight: 700; 
            text-transform: uppercase; 
            cursor: pointer; 
            border-radius: 10px; 
            margin-top: 5px; 
        }

        .btn:active { 
            transform: scale(0.98); 
            opacity: 0.9; 
        }

        .btn-outline { 
            background: transparent; 
            color: var(--primary); 
            border: 1px solid var(--border); 
        }

        .btn-close { 
            background: transparent; 
            border: none; 
            font-size: 24px; 
            color: var(--secondary); 
            padding: 10px; 
        }
        
        .btn-small {
            padding: 8px 15px; 
            font-size: 11px; 
            border-radius: 15px; 
            background: var(--surface-light); 
            border: 1px solid var(--border); 
            color: var(--primary);
        }
        
        /* PLAYER BUTTONS SPLIT */
        .player-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: auto;
            width: 100%;
        }

        input { 
            width: 100%; 
            background: var(--surface-light); 
            border: 1px solid var(--border); 
            color: var(--primary); 
            padding: 12px; 
            font-size: 16px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            appearance: none; 
        }
        
        /* LIBRARY ITEMS */
        .lib-item { 
            padding: 15px; 
            background: var(--surface-light); 
            border: 1px solid var(--border); 
            border-radius: 10px; 
            margin-bottom: 8px; 
            cursor: pointer; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tag { 
            font-size: 9px; 
            padding: 4px 8px; 
            background: var(--accent); 
            color: #000; 
            border-radius: 6px; 
            font-weight: 800; 
            text-transform: uppercase; 
        }

        /* WATER TRACKER */
        .water-grid { 
            display: flex; 
            justify-content: space-between; 
            margin-top: 5px; 
            gap: 2px;
        }

        .water-cup { 
            flex: 1;
            height: 35px; 
            background: var(--surface-light); 
            border: 1px solid #333; 
            border-radius: 4px; 
            cursor: pointer; 
            position: relative; 
        }

        .water-cup.full { 
            background: var(--blue); 
            border-color: var(--blue); 
        }
        
        .water-info {
            font-size: 10px;
            color: var(--blue);
            font-weight: bold;
            margin-left: 5px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .water-info.show {
            opacity: 1;
        }

        /* TOGGLE SWITCH */
        .toggle-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px 0; 
        }

        .switch { 
            position: relative; 
            display: inline-block; 
            width: 46px; 
            height: 26px; 
        }

        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }

        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #3a3a3c; 
            transition: .4s; 
            border-radius: 34px; 
        }

        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            left: 3px; 
            bottom: 3px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }

        input:checked + .slider { 
            background-color: var(--accent); 
        }

        input:checked + .slider:before { 
            transform: translateX(20px); 
        }

        input[type="range"] { 
            margin: 10px 0; 
            accent-color: var(--primary); 
        }

        /* CHARTS */
        .chart-container { 
            width: 100%; 
            height: 120px;
            position: relative; 
            margin-top: 10px; 
            border-bottom: 1px solid var(--border); 
            border-left: 1px solid var(--border); 
        }

        svg.chart { 
            width: 100%; 
            height: 100%; 
            overflow: visible; 
        }

        polyline { 
            fill: none; 
            stroke: var(--primary); 
            stroke-width: 2; 
            vector-effect: non-scaling-stroke; 
        }

        /* OVERLAYS */
        .full-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--bg); 
            z-index: 2000; 
            display: none; 
            flex-direction: column; 
            padding: var(--safe-top) 20px 20px 20px; 
            overflow-y: auto; 
        }

        /* PLAYER */
        .timer-wrap { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            min-height: 200px; 
        }

        .progress-ring { 
            width: 240px; 
            height: 240px; 
            transform: rotate(-90deg); 
        }
        
        .time-center { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            text-align: center; 
        }

        .time-huge { 
            font-size: 70px; 
            font-weight: 700; 
            font-family: monospace; 
            letter-spacing: -3px; 
            line-height: 1; 
        }

        .phase-lbl { 
            font-size: 16px; 
            font-weight: 600; 
            letter-spacing: 4px; 
            display: block; 
            color: var(--accent); 
            margin-top: 10px; 
        }
        
        /* CHECKS */
        .check-item { 
            padding: 12px; 
            border: 1px solid var(--border); 
            background: var(--surface); 
            border-radius: 10px; 
            font-size: 15px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin-bottom: 8px; 
            cursor: pointer; 
        }

        .check-item.checked { 
            border-color: var(--accent); 
            background: rgba(50, 215, 75, 0.1); 
        }

        .check-box-visual { 
            width: 24px; 
            height: 24px; 
            border: 2px solid var(--secondary); 
            border-radius: 5px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 16px; 
            color: transparent; 
        }

        .check-item.checked .check-box-visual { 
            background: var(--accent); 
            border-color: var(--accent); 
            color: #000; 
        }

        /* NAVIGATION */
        .nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            height: 65px; 
            background: rgba(0,0,0,0.95); 
            border-top: 1px solid var(--border); 
            backdrop-filter: blur(20px); 
            display: flex; 
            justify-content: space-around; 
            padding-bottom: var(--safe-bottom); 
            z-index: 1000; 
        }

        .nav-btn { 
            flex: 1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            opacity: 0.4; 
            font-size: 22px; 
            cursor: pointer; 
            color: white; 
        }

        .nav-btn.active { 
            opacity: 1; 
            color: var(--primary); 
        }
        
        /* WIZARD */
        .opt-item { 
            padding: 18px; 
            border: 1px solid var(--border); 
            margin-bottom: 10px; 
            cursor: pointer; 
            border-radius: 10px; 
            background: var(--surface); 
            font-weight: 500; 
            text-align: center; 
        }

        .opt-item.selected { 
            border-color: var(--primary); 
            background: var(--surface-light); 
            color: var(--primary); 
        }

        .wiz-step { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
        }

        .wiz-step.active { 
            display: flex; 
            animation: fade 0.3s; 
        }

        @keyframes fade { from{opacity:0;} to{opacity:1;} }

    </style>
</head>
<body>

    <div id="view-onboarding" class="full-overlay">
        
        <div id="wiz-1" class="wiz-step active">
            <h1 style="margin-top:20px;">ZIELSETZUNG</h1>
            <p class="label">Was ist dein Fokus?</p>
            <div style="margin-top:20px;">
                <div class="opt-item" onclick="wizSet('goal', 'lose', this)">ABNEHMEN</div>
                <div class="opt-item" onclick="wizSet('goal', 'build', this)">MUSKELAUFBAU</div>
                <div class="opt-item" onclick="wizSet('goal', 'fit', this)">ALLG. FITNESS</div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizNext(1)">WEITER</button>
        </div>

        <div id="wiz-2" class="wiz-step">
            <h1 style="margin-top:20px;">FOKUS ZONEN</h1>
            <p class="label">W√§hle deine Bereiche:</p>
            <div style="margin-top:20px;">
                <div class="opt-item" onclick="wizToggle('parts', 'bauch', this)">BAUCH & CORE</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ruecken', this)">R√úCKEN</div>
                <div class="opt-item" onclick="wizToggle('parts', 'beine', this)">BEINE & PO</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ober', this)">OBERK√ñRPER</div>
                <div class="opt-item" onclick="wizToggle('parts', 'stuhl', this)">STUHL / SOFA</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ganz', this)">GANZK√ñRPER</div>
                <div class="opt-item" onclick="wizToggle('parts', 'cardio', this)">CARDIO</div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizNext(2)">WEITER</button>
        </div>

        <div id="wiz-3" class="wiz-step">
            <h1 style="margin-top:20px;">DATEN</h1>
            <div class="card" style="margin-top:20px;">
                <input type="number" id="wiz-age" placeholder="Alter">
                <div class="input-row">
                    <input type="number" id="wiz-height" placeholder="Gr√∂√üe (cm)">
                    <input type="number" id="wiz-weight" placeholder="Gewicht (kg)">
                </div>
                <div class="input-row">
                    <div class="opt-item" style="padding:15px;" onclick="wizSet('sex','m',this)">MANN</div>
                    <div class="opt-item" style="padding:15px;" onclick="wizSet('sex','f',this)">FRAU</div>
                </div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizFinish()">STARTEN</button>
        </div>
    </div>

    <div id="tab-home" class="screen active" style="padding:10px;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <div style="padding:5px;">
                <span class="label">DEINE REISE</span>
                <h1 style="margin:0; font-size:40px;">TAG <span id="day-count">1</span></h1>
            </div>
            <div style="text-align:right;">
                <div style="font-size:12px; font-weight:bold; color:var(--fire);">üî• <span id="streak-val">0</span></div>
                <div style="font-size:12px; margin-top:2px; color:var(--primary); opacity:0.7;" id="lvl-badge">LVL 1</div>
            </div>
        </div>

        <div class="stat-grid">
            <div class="card compact-card" style="margin:0; text-align:center;">
                <span class="label">LIFETIME KCAL</span>
                <span class="val-big" id="disp-total-kcal">0</span>
            </div>
            <div class="card compact-card" style="margin:0; text-align:center;">
                <span class="label">BMI INDEX</span>
                <span class="val-big" id="disp-bmi">0.0</span>
            </div>
        </div>

        <div class="card compact-card">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span class="label">WORKOUTS</span>
                <span class="label">GESAMT</span>
            </div>
            <div class="stat-grid-3">
                <div style="text-align:center; background:var(--surface-light); padding:8px; border-radius:6px;">
                    <span class="label">WOCHE</span>
                    <div class="val-big" id="min-week">0</div>
                </div>
                <div style="text-align:center; background:var(--surface-light); padding:8px; border-radius:6px;">
                    <span class="label">MONAT</span>
                    <div class="val-big" id="min-month">0</div>
                </div>
                <div style="text-align:center; background:var(--surface-light); padding:8px; border-radius:6px;">
                    <span class="label">JAHR</span>
                    <div class="val-big" id="min-year">0</div>
                </div>
            </div>
        </div>

        <div class="card compact-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin:0;">WASSER</h2>
                <div>
                    <span id="water-added-msg" class="water-info">+250ml</span>
                    <span id="water-val" style="color:var(--blue); font-weight:bold; font-size:14px;">0 / 2.0 L</span>
                </div>
            </div>
            <div class="water-grid" id="water-grid"></div>
        </div>

        <div class="card compact-card" style="border: 1px solid var(--primary); margin-top:5px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin:0; color:white;">TRAINING STARTEN</h2>
            </div>
            <p class="label" style="margin-top:5px;">Dauer w√§hlen:</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px; margin-top:5px;">
                <button class="btn btn-outline" style="margin:0; padding:12px; font-size:12px;" id="dur-10" onclick="setWorkoutDuration(10, this)">10 MIN</button>
                <button class="btn btn-outline" style="margin:0; padding:12px; font-size:12px;" id="dur-20" onclick="setWorkoutDuration(20, this)">20 MIN</button>
                <button class="btn btn-outline" style="margin:0; padding:12px; font-size:12px;" id="dur-30" onclick="setWorkoutDuration(30, this)">30 MIN</button>
            </div>
            <button class="btn" style="margin-top:8px; padding:12px;" onclick="openPlayer()">LOS GEHT'S</button>
        </div>
        
        <button class="btn btn-outline" style="margin-top:5px; padding:10px; font-size:12px; border-style:dashed; opacity:0.8;" onclick="openSuppsManually()">SUPPLEMENTE & NOTIZ</button>
    </div>

    <div id="tab-library" class="screen">
        <h1>BIBLIOTHEK</h1>
        <div id="lib-list"></div>
    </div>

    <div id="tab-stats" class="screen">
        <h1>TRACKING</h1>
        <button class="btn btn-outline" onclick="openKcalCalc()" style="margin-bottom:15px; border-color:var(--fire); color:var(--fire);">üî• KALORIEN-BEDARF</button>
        
        <div class="card">
            <h2>GEWICHTSKURVE</h2>
            <div class="chart-container">
                <svg class="chart" id="weight-chart" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
            </div>
        </div>
        
        <div class="card">
            <h2>MESSUNG</h2>
            <input type="date" id="log-date">
            <div class="input-row">
                <input type="number" id="log-weight" step="0.1" placeholder="Gewicht (kg)">
                <input type="number" id="log-waist" placeholder="Bauch (cm)">
            </div>
            <div class="input-row">
                <input type="number" id="log-hips" placeholder="H√ºfte/Po (cm)">
                <input type="number" id="log-chest" placeholder="Brust (cm)">
            </div>
            <div class="input-row">
                <input type="number" id="log-thigh" placeholder="Oberschenkel (cm)">
                <input type="number" id="log-biceps" placeholder="Bizeps (cm)">
            </div>
            <button class="btn btn-outline" onclick="saveLog()">WERTE SPEICHERN</button>
        </div>
        
        <div class="card">
            <h2>HISTORIE</h2>
            <div id="hist-list"></div>
        </div>
    </div>

    <div id="tab-settings" class="screen">
        <h1>SYSTEM</h1>
        <div class="card">
            <h2>TIMER</h2>
            <div class="toggle-row"><span>Belastung: <b id="lbl-work">40</b> Sek</span></div>
            <input type="range" min="20" max="90" step="5" id="rng-work" oninput="updateRangeLbl()" onchange="saveSettings()">
            <div class="toggle-row"><span>Pause: <b id="lbl-rest">20</b> Sek</span></div>
            <input type="range" min="10" max="60" step="5" id="rng-rest" oninput="updateRangeLbl()" onchange="saveSettings()">
        </div>
        <div class="card">
            <h2>OPTIONEN</h2>
            <div class="toggle-row"><span>Supplements Pop-up</span><label class="switch"><input type="checkbox" id="tog-supps" onchange="saveSettings()"><span class="slider"></span></label></div>
            <div class="toggle-row"><span>Stimme (Coach)</span><label class="switch"><input type="checkbox" id="tog-voice" onchange="saveSettings()"><span class="slider"></span></label></div>
        </div>
        <div class="card">
            <h2>DATEN</h2>
            <button class="btn btn-outline" onclick="exportData()">BACKUP SPEICHERN</button>
            <input type="file" id="import-input" style="display:none" onchange="importData(this)" onclick="this.value=null">
            <button class="btn btn-outline" style="margin-top:8px" onclick="document.getElementById('import-input').click()">BACKUP LADEN</button>
            <button class="btn btn-outline" style="margin-top:15px; color:#ff453a; border-color:#ff453a;" onclick="resetApp()">RESET</button>
        </div>
    </div>

    <div id="view-player" class="full-overlay" style="background:#000; z-index:3000;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button class="btn-close" onclick="closePlayer()">‚úï</button>
            <span id="round-disp">1 / 6</span>
            <button class="btn-close" onclick="toggleMute()" id="mute-icon">üîä</button>
        </div>
        
        <div class="timer-wrap">
            <svg class="progress-ring" width="240" height="240">
                <circle stroke="#222" stroke-width="8" fill="transparent" r="115" cx="120" cy="120"/>
                <circle id="progress-circle" style="transition: stroke-dashoffset 1s linear;" stroke="white" stroke-width="8" stroke-linecap="round" fill="transparent" r="115" cx="120" cy="120" stroke-dasharray="722 722"/>
            </svg>
            <div class="time-center">
                <div class="time-huge" id="time-disp">00</div>
                <span id="phase-disp" class="phase-lbl">READY</span>
            </div>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
            <div id="ex-name" style="font-size:22px; font-weight:700;">√úbung</div>
            <button class="btn-outline" style="padding:8px 15px; font-size:11px; margin-top:10px; border-radius:20px;" onclick="showInfoAndPause()">ANLEITUNG</button>
        </div>

        <div class="player-controls">
            <button class="btn" id="play-btn" onclick="toggleTimer()">START</button>
            <button class="btn" id="skip-btn" style="background:#333; color:white; border:1px solid #444;" onclick="nextStep()">√úBERSPRINGEN</button>
        </div>
    </div>

    <div id="view-info" class="full-overlay" style="z-index:5000; background:#000;">
        <button class="btn-close" onclick="closeInfoAndResume()">‚úï</button>
        <h1 id="info-title" style="margin-top:20px;">√úBUNG</h1>
        <p id="info-desc" style="font-size:18px; line-height:1.6; color:#ccc; margin-top:20px;"></p>
    </div>

    <div id="view-calc" class="full-overlay" style="z-index:4000;">
        <button class="btn-close" onclick="document.getElementById('view-calc').style.display='none'">‚úï</button>
        <h1>KALORIEN</h1>
        <div class="stat-grid-3" style="margin-top:20px;">
            <div class="card" style="text-align:center; margin:0;"><h2 style="margin:0">BASIS</h2><div id="calc-bmr" class="val-big" style="color:#888">0</div></div>
            <div class="card" style="text-align:center; margin:0; border-color:var(--accent)"><h2 style="margin:0">ABNEHMEN</h2><div id="calc-cut" class="val-big" style="color:var(--accent)">0</div></div>
            <div class="card" style="text-align:center; margin:0; border-color:var(--blue)"><h2 style="margin:0">AUFBAU</h2><div id="calc-bulk" class="val-big" style="color:var(--blue)">0</div></div>
        </div>
    </div>
    
    <div id="view-supps" class="full-overlay" style="z-index: 5000; justify-content:center; text-align:center;">
        <button class="btn-close" style="position:absolute; top:var(--safe-top); right:25px;" onclick="document.getElementById('view-supps').style.display='none'">‚úï</button>
        <h1 style="margin-bottom:10px; margin-top:40px;">DONE!</h1>
        <div id="supp-custom-msg" style="display:none; margin-bottom:20px; font-size:18px; color:var(--accent); font-weight:bold; font-style:italic;"></div>
        <p class="label">Notiz:</p>
        <input type="text" class="msg-input" id="supp-live-msg" placeholder="..." oninput="saveSuppMsg(this)" style="text-align:center; border:1px dashed #444;">
        <div id="check-list-container" style="text-align:left; display:inline-block; width:100%; margin-top:20px;">
            <div class="check-item" onclick="toggleCheck(this, 0)"><div class="check-box-visual">‚úî</div><div>ü•§ Eiwei√ü Shake</div></div>
            <div class="check-item" onclick="toggleCheck(this, 1)"><div class="check-box-visual">‚úî</div><div>‚ö° Kreatin</div></div>
            <div class="check-item" onclick="toggleCheck(this, 2)"><div class="check-box-visual">‚úî</div><div>üíä Magnesium</div></div>
            <div class="check-item" onclick="toggleCheck(this, 3)"><div class="check-box-visual">‚úî</div><div>üî© Eisen / Vitamine</div></div>
        </div>
        <button class="btn" style="margin-top:30px;" onclick="document.getElementById('view-supps').style.display='none'">FERTIG</button>
    </div>

    <nav class="nav">
        <div class="nav-btn active" onclick="nav('tab-home', this)">‚ñ†</div>
        <div class="nav-btn" onclick="nav('tab-library', this)">üìñ</div>
        <div class="nav-btn" onclick="nav('tab-stats', this)">lll</div>
        <div class="nav-btn" onclick="nav('tab-settings', this)">‚óè</div>
    </nav>

    <script>
        const STORE_KEY = 'bp_v14_final';
        
        const DB = {
            bauch: [
                {n:"Crunches", d:"Lege dich auf den R√ºcken, Beine angewinkelt aufstellen. H√§nde leicht an den Kopf (nicht ziehen!). Hebe die Schulterbl√§tter durch Anspannen der Bauchmuskeln vom Boden ab. Ausatmen beim Hochgehen."},
                {n:"Leg Raises", d:"R√ºckenlage, H√§nde flach unter den Po zur St√ºtze. Hebe die gestreckten Beine langsam an bis sie senkrecht sind, dann kontrolliert senken ohne den Boden zu ber√ºhren. Unterer R√ºcken bleibt am Boden!"},
                {n:"Plank", d:"Der Unterarmst√ºtz. Ellbogen unter den Schultern platzieren. Beine strecken. Der K√∂rper bildet eine gerade Linie. Spanne Po und Bauch maximal an. Atmen nicht vergessen!"},
                {n:"Russian Twist", d:"Setz dich hin, lehne den Oberk√∂rper leicht zur√ºck (R√ºcken gerade!). F√º√üe leicht anheben f√ºr mehr Intensit√§t. Rotiere den Oberk√∂rper und ber√ºhre abwechselnd links und rechts den Boden."},
                {n:"Mountain Climbers", d:"Starte in der Liegest√ºtz-Position. Ziehe abwechselnd die Knie schnell und dynamisch unter den K√∂rper Richtung Brust. Der R√ºcken bleibt gerade, der Po tief."}
            ],
            beine: [
                {n:"Squats", d:"Stelle dich schulterbreit hin. Gehe tief in die Hocke, als w√ºrdest du dich auf einen Stuhl setzen. Gewicht auf die Fersen. Achte darauf, dass die Knie nicht nach innen knicken. R√ºcken gerade!"},
                {n:"Lunges", d:"Mache einen gro√üen Schritt nach vorn. Senke das hintere Knie bis kurz vor den Boden. Beide Beine sollten ca. 90 Grad haben. Dr√ºck dich √ºber die vordere Ferse wieder hoch."},
                {n:"Glute Bridges", d:"R√ºckenlage, F√º√üe nah am Po aufstellen. Dr√ºcke das Becken so hoch es geht zur Decke. Oben den Po fest zusammenkneifen und kurz halten. Langsam ablassen."},
                {n:"Wall Sit", d:"Lehne dich mit dem R√ºcken flach an eine Wand und rutsche runter, bis deine Beine im 90-Grad-Winkel sind. H√§nde h√§ngen locker an der Seite. Halte die Spannung!"},
                {n:"Calf Raises", d:"Stell dich aufrecht hin (evtl. an Wand festhalten f√ºr Balance). Dr√ºcke dich hoch auf die Zehenspitzen, halte kurz die Spannung in den Waden, und senke die Fersen langsam wieder ab."}
            ],
            ober: [
                {n:"Push-Ups", d:"Klassische Liegest√ºtze. H√§nde unter den Schultern. K√∂rper fest wie ein Brett. Brust bis fast zum Boden senken. Ellbogen zeigen eher nach hinten (Pfeilform), nicht 90 Grad zur Seite."},
                {n:"Dips", d:"St√ºtze dich an einer stabilen Kante (Stuhl/Bett) ab. Beine gestreckt oder gebeugt. Senke den Po ab, indem du die Arme beugst. Dr√ºck dich aus dem Trizeps wieder hoch."},
                {n:"Shoulder Taps", d:"Ausgangsposition: Hohe Plank (Liegest√ºtz-Position). Ber√ºhre abwechselnd mit der linken Hand die rechte Schulter und umgekehrt. Versuche dabei, die H√ºfte ganz ruhig zu halten."},
                {n:"Pike Pushups", d:"Schulter-Pushup: Po weit in die H√∂he strecken (umgekehrtes V). Beine gestreckt. Beuge die Arme und senke den Kopf Richtung Boden zwischen die H√§nde. Dr√ºck dich raus."},
                {n:"Diamond Pushups", d:"Schwere Variante: H√§nde unter der Brust so zusammenlegen, dass Daumen und Zeigefinger ein Dreieck bilden. Gehe tief. Geht extrem auf den Trizeps."}
            ],
            ruecken: [
                {n:"Superman", d:"Lege dich auf den Bauch. Strecke Arme nach vorne und Beine nach hinten. Hebe nun Arme und Beine gleichzeitig so hoch wie m√∂glich an. Sp√ºre den unteren R√ºcken. Kurz halten."},
                {n:"Aquaman", d:"Wie Superman, aber du hebst abwechselnd linken Arm/rechtes Bein und rechten Arm/linkes Bein. Dynamische Bewegung f√ºr die R√ºckenstrecker."},
                {n:"Bird Dog", d:"Vierf√º√ülerstand. Strecke den rechten Arm nach vorn und das linke Bein nach hinten. Mach dich lang. F√ºhre Ellbogen und Knie unter dem Bauch zusammen und strecke wieder."},
                {n:"Prone W-Raise", d:"Bauchlage. Arme seitlich angewinkelt (wie ein 'W'). Hebe den Oberk√∂rper und ziehe die Schulterbl√§tter aktiv zusammen. Halten und senken."}
            ],
            stuhl: [
                {n:"Chair Dips", d:"Setz dich auf die Stuhlkante, H√§nde neben den Po. Rutsch mit dem Po vor den Stuhl. Beuge die Arme, senke den Po ab und dr√ºck dich wieder hoch."},
                {n:"Bulgarian Split Squats", d:"Ein Fu√ü liegt mit dem Spann hinten auf dem Stuhl/Sofa auf. Das andere Bein steht weit vorn. Beuge das vordere Bein tief. Der Oberk√∂rper bleibt aufrecht."},
                {n:"Step-Ups", d:"Stell dich vor den Stuhl (muss stabil sein!). Steige mit einem Bein komplett hoch, richte dich ganz auf, und steig wieder ab. Wechsel das Bein."},
                {n:"Incline Push-Ups", d:"H√§nde auf die Sitzfl√§che des Stuhls, F√º√üe am Boden. K√∂rper bildet eine Linie. Senke die Brust zur Stuhlkante. Einfacher als normale Liegest√ºtze."}
            ],
            ganz: [
                {n:"Burpees", d:"Aus dem Stand in die Hocke, H√§nde auf den Boden, Sprung zur√ºck in den St√ºtz, (optional Liegest√ºtz), Sprung vor in die Hocke und Strecksprung nach oben."},
                {n:"Jumping Jacks", d:"Hampelmann: Springe in den breiten Stand, H√§nde ber√ºhren sich √ºber dem Kopf. Springe zur√ºck, H√§nde an die Seite. Bleib auf den Fu√üballen."},
                {n:"Squat Jumps", d:"Mache eine normale Kniebeuge, aber dr√ºcke dich explosiv ab und springe so hoch du kannst. Lande weich und gehe direkt in die n√§chste Beuge."},
                {n:"Plank Jacks", d:"Unterarmst√ºtz. Springe mit den F√º√üen auseinander (wie beim Hampelmann) und wieder zusammen. Halte die H√ºfte dabei so stabil wie m√∂glich."}
            ],
            cardio: [
                {n:"High Knees", d:"Lauf auf der Stelle, aber zieh die Knie dabei so hoch wie m√∂glich (mindestens H√ºfth√∂he). Nimm die Arme dynamisch mit. Gib Gas!"},
                {n:"Skaters", d:"Springe seitlich von einem Bein auf das andere. Das freie Bein kreuzt hinten. Nimm den gegen√ºberliegenden Arm mit zum Boden. Wie beim Eisschnelllauf."},
                {n:"Butt Kicks", d:"Laufen am Platz, dabei die Fersen aktiv zum Po ziehen. Oberk√∂rper leicht vorgeneigt."},
                {n:"Fast Feet", d:"Steh schulterbreit, geh leicht in die Knie. Tippel so schnell du kannst auf der Stelle (nur Fu√üballen). Der Boden ist Lava!"}
            ]
        };
        
        const catMap = {
            'bauch': 'Bauch & Core',
            'beine': 'Beine & Po',
            'ober': 'Oberk√∂rper',
            'ruecken': 'R√ºcken',
            'stuhl': 'Stuhl/Sofa',
            'ganz': 'Ganzk√∂rper',
            'cardio': 'Cardio'
        };

        let app = { 
            profile: { h:0, w:0, a:0, s:'m' }, 
            parts: [], history: [], logs: [], 
            settings: { work:40, rest:20, duration:10, supps:true, suppMsg:"", suppState:[0,0,0,0], voice:false }, 
            water: { count:0, date:"" }, streak: { count:0, last:"" }, currentWorkout: [],
            installDate: ""
        };
        let sess = { run:false, int:null, t:0, idx:0, r:1, work:false, preview:null };
        let wiz = { parts:[], sex:'m' };
        let ac=null, sound=true;

        window.onload = () => {
            const d = localStorage.getItem(STORE_KEY);
            if(d) { app = JSON.parse(d); initApp(); } else { document.getElementById('view-onboarding').style.display = 'flex'; }
            renderLibrary();
        };

        function initApp() {
            document.getElementById('view-onboarding').style.display = 'none';
            // Init Checks
            if(!app.water) app.water = { count:0, date:new Date().toDateString() };
            if(!app.streak) app.streak = { count:0, last:"" };
            if(!app.installDate) { app.installDate = new Date().toISOString(); save(); }
            
            // Daily Reset
            if(app.water.date !== new Date().toDateString()) { app.water.count=0; app.water.date=new Date().toDateString(); save(); }
            renderWater();

            // Streak check
            if(app.streak.last) {
                const diff = (new Date() - new Date(app.streak.last)) / (1000*3600*24);
                if(diff > 2) { app.streak.count = 0; save(); }
            }
            document.getElementById('streak-val').innerText = app.streak.count;
            
            // Day Count
            const dayDiff = Math.abs(new Date() - new Date(app.installDate));
            const daysSince = Math.ceil(dayDiff / (1000 * 60 * 60 * 24));
            document.getElementById('day-count').innerText = daysSince || 1;
            
            // Load UI
            document.getElementById('set-height').value = app.profile.h||'';
            document.getElementById('set-age').value = app.profile.a||'';
            document.getElementById('rng-work').value = app.settings.work||40;
            document.getElementById('rng-rest').value = app.settings.rest||20;
            document.getElementById('tog-supps').checked = app.settings.supps;
            document.getElementById('tog-voice').checked = app.settings.voice;
            document.getElementById('supp-live-msg').value = app.settings.suppMsg||"";
            restoreSupps();
            setWorkoutDuration(app.settings.duration||10, document.getElementById('dur-'+(app.settings.duration||10)));
            updateRangeLbl(); updateUI();
        }

        // --- CORE LOGIC ---
        function setWorkoutDuration(min, el) {
            app.settings.duration = min;
            ['dur-10','dur-20','dur-30'].forEach(id=>{
                const b=document.getElementById(id); b.className='btn btn-outline'; b.style.background='transparent'; b.style.color='var(--primary)';
            });
            if(el){el.className='btn'; el.style.background='white'; el.style.color='black';}
            generateWorkout(); save();
        }

        function generateWorkout() {
            let pool = [];
            // RULE: Always include Bauch & R√ºcken
            if(DB.bauch) pool.push(DB.bauch[Math.floor(Math.random()*DB.bauch.length)]);
            if(DB.ruecken) pool.push(DB.ruecken[Math.floor(Math.random()*DB.ruecken.length)]);
            
            // Fill rest
            let cats = (app.parts && app.parts.length>0) ? app.parts : Object.keys(DB);
            let fillPool = [];
            cats.forEach(c => { if(DB[c]) {
                DB[c].forEach(ex => { ex.cat = c; fillPool.push(ex); }); 
            }});
            
            // Shuffle fill
            for(let i=fillPool.length-1; i>0; i--){ const j=Math.floor(Math.random()*(i+1)); [fillPool[i],fillPool[j]]=[fillPool[j],fillPool[i]]; }
            
            const count = app.settings.duration === 10 ? 6 : (app.settings.duration === 20 ? 10 : 14);
            // Add unique items until full
            for(let ex of fillPool) {
                if(pool.length < count && !pool.includes(ex)) pool.push(ex);
            }
            // Reshuffle final
            for(let i=pool.length-1; i>0; i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
            app.currentWorkout = pool;
        }

        // --- PLAYER ---
        function openPlayer() {
            if(app.currentWorkout.length===0) generateWorkout();
            if(!ac) ac = new (window.AudioContext||window.webkitAudioContext)();
            sess.idx=0; sess.r=1; sess.t=10; sess.work=false;
            document.getElementById('view-player').style.display='flex';
            startPhase('PREP');
        }

        function startPhase(type) {
            sess.work = (type==='WORK');
            // document.getElementById('skip-btn').style.display = sess.work ? 'none' : 'block'; // User wanted it always visible/split layout
            
            if(type==='PREP') {
                sess.t=10; document.getElementById('phase-disp').innerText="READY";
                sess.preview=app.currentWorkout[0]; document.getElementById('ex-name').innerText="Start: "+sess.preview.n;
                speak("Bereit machen");
            } else if(type==='WORK') {
                sess.t=parseInt(app.settings.work); document.getElementById('phase-disp').innerText="WORK";
                sess.preview=app.currentWorkout[sess.idx]; document.getElementById('ex-name').innerText=sess.preview.n;
                beep(400,800); speak("Start");
            } else {
                sess.t=parseInt(app.settings.rest); document.getElementById('phase-disp').innerText="PAUSE";
                beep(600,300); speak("Pause");
                let n = sess.idx+1; if(n>=app.currentWorkout.length) n=0;
                if(sess.idx>=app.currentWorkout.length-1 && sess.r>=3) document.getElementById('ex-name').innerText="GLEICH GESCHAFFT!";
                else { sess.preview=app.currentWorkout[n]; document.getElementById('ex-name').innerText="Next: "+sess.preview.n; }
            }
            updatePlayerUI(); if(!sess.run) toggleTimer();
        }

        function tick() {
            if(sess.t>0) {
                sess.t--;
                if(sess.work && sess.t===Math.floor(app.settings.work/2)) speak("H√§lfte");
                if(sess.t<=3) beep(1000,1000,0.05);
                updatePlayerUI();
            } else nextStep();
        }

        function nextStep() {
            if(document.getElementById('phase-disp').innerText==="READY") startPhase('WORK');
            else if(sess.work) {
                if(sess.idx>=app.currentWorkout.length-1 && sess.r>=3) { clearInterval(sess.int); finishWorkout(); }
                else startPhase('REST');
            } else {
                sess.idx++; if(sess.idx>=app.currentWorkout.length) { sess.idx=0; sess.r++; }
                document.getElementById('round-disp').innerText = sess.idx+1 + " / " + app.currentWorkout.length;
                startPhase('WORK');
            }
        }

        function updatePlayerUI() {
            document.getElementById('time-disp').innerText = sess.t;
            const max = sess.work ? app.settings.work : (sess.idx===0&&sess.r===1?10:app.settings.rest);
            const circ = 2*Math.PI*115;
            document.getElementById('progress-circle').style.strokeDashoffset = circ - (sess.t/max)*circ;
        }

        function finishWorkout() {
            const dur = app.settings.duration;
            app.history.push({ date:new Date(), kcal:dur*8, duration:dur });
            
            const today = new Date().toDateString();
            if(app.streak.last !== today) { app.streak.count++; }
            app.streak.last = today;
            
            save(); updateUI();
            if(app.settings.supps) {
                document.getElementById('view-player').style.display='none';
                openSuppsManually();
            } else location.reload();
        }

        // --- WATER ---
        function renderWater() {
            const g = document.getElementById('water-grid'); g.innerHTML='';
            for(let i=0; i<8; i++){
                let d=document.createElement('div'); d.className='water-cup'+(i<app.water.count?' full':'');
                d.onclick=()=>{ 
                    app.water.count = (i<app.water.count) ? i : i+1; 
                    save(); renderWater(); 
                    let inf = document.getElementById('water-added-msg');
                    inf.classList.add('show'); setTimeout(()=>inf.classList.remove('show'), 1000);
                };
                g.appendChild(d);
            }
            document.getElementById('water-val').innerText = (app.water.count*0.25).toFixed(2) + " / 2.0 L";
        }

        // --- UI & STATS ---
        function updateUI() {
            let mWeek=0, mMonth=0, mYear=0, total=0, wCount=0;
            const now=new Date(); const startW=new Date(now); startW.setDate(now.getDate()-(now.getDay()||7)+1); startW.setHours(0,0,0,0);
            
            app.history.forEach(h=>{
                const d=new Date(h.date); const dur=h.duration||10; total+=dur;
                if(d>=startW) { wCount++; mWeek++; }
                if(d.getMonth()===now.getMonth()) mMonth++;
                if(d.getFullYear()===now.getFullYear()) mYear++;
            });
            
            document.getElementById('min-week').innerText=mWeek;
            document.getElementById('min-month').innerText=mMonth;
            document.getElementById('min-year').innerText=mYear;
            
            // Level
            const lvl = 1 + Math.floor(total/60);
            document.getElementById('lvl-badge').innerText = "LVL " + lvl;
            document.getElementById('streak-val').innerText = app.streak.count;

            // Total Kcal & BMI
            let totalKcal=0; app.history.forEach(h=>totalKcal+=(h.kcal||0)); 
            document.getElementById('disp-total-kcal').innerText=totalKcal.toLocaleString();
            
            const hM=app.profile.h/100; 
            document.getElementById('disp-bmi').innerText=(app.profile.h&&app.profile.w)?(app.profile.w/(hM*hM)).toFixed(1):"-";

            renderHist(); renderChart();
        }

        // --- HELPERS ---
        function toggleTimer(){ const b=document.getElementById('play-btn'); if(sess.run){clearInterval(sess.int);sess.run=false;b.innerText="WEITER";}else{sess.int=setInterval(tick,1000);sess.run=true;b.innerText="STOP";} }
        function toggleMute(){ sound=!sound; document.getElementById('mute-icon').innerText=sound?"üîä":"üîá"; }
        function speak(m){ if(app.settings.voice && window.speechSynthesis){ const u=new SpeechSynthesisUtterance(m); u.lang='de-DE'; window.speechSynthesis.speak(u); } }
        function beep(f1,f2,d){ if(!app.settings.voice && sound && ac){ const o=ac.createOscillator(); const g=ac.createGain(); o.connect(g); g.connect(ac.destination); o.type='sawtooth'; o.frequency.setValueAtTime(f1,ac.currentTime); o.frequency.exponentialRampToValueAtTime(f2,ac.currentTime+d); g.gain.setValueAtTime(0.05,ac.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ac.currentTime+d); o.start(); o.stop(ac.currentTime+d); } }
        
        function showInfoAndPause() {
            if(sess.preview) {
                document.getElementById('info-title').innerText = sess.preview.n;
                document.getElementById('info-desc').innerText = sess.preview.d;
                document.getElementById('view-info').style.display = 'flex';
                if(sess.run) { toggleTimer(); sess.wasRunning=true; } else sess.wasRunning=false;
            }
        }
        function closeInfoAndResume() { document.getElementById('view-info').style.display='none'; if(sess.wasRunning && !sess.run) toggleTimer(); }
        
        function openSuppsManually() { document.getElementById('view-supps').style.display='flex'; restoreSupps(); }
        function toggleCheck(el,i) { el.classList.toggle('checked'); app.settings.suppState[i]=el.classList.contains('checked'); save(); }
        function restoreSupps() { const l=document.querySelectorAll('#check-list-container .check-item'); app.settings.suppState.forEach((s,i)=>{if(l[i]) s?l[i].classList.add('checked'):l[i].classList.remove('checked')}); }
        function saveSuppMsg(el) { app.settings.suppMsg=el.value; save(); }
        
        function openKcalCalc() {
            const h=parseFloat(app.profile.h), w=parseFloat(app.profile.w), a=parseFloat(app.profile.a);
            if(!h||!w) { alert("Daten fehlen!"); return; }
            let bmr = 10*w + 6.25*h - 5*a + (app.profile.s==='m'?5:-161);
            let tdee = Math.round(bmr*1.35);
            document.getElementById('calc-bmr').innerText=Math.round(bmr); document.getElementById('calc-cut').innerText=Math.round(tdee-400); document.getElementById('calc-bulk').innerText=Math.round(tdee+300);
            document.getElementById('view-calc').style.display='flex';
        }

        // --- ROBUST BACKUP IMPORT ---
        function importData(el) {
            if(!el.files.length) return;
            const r = new FileReader();
            r.onload = e => {
                try {
                    const data = JSON.parse(e.target.result);
                    // Minimal Validation, merge into current structure
                    app = { ...app, ...data }; 
                    if(data.profile) app.profile = data.profile; // Ensure profile is kept
                    save(); 
                    alert("Daten erfolgreich importiert!"); 
                    location.reload();
                } catch(err) { alert("Fehler beim Laden: "+err.message); }
            };
            r.readAsText(el.files[0]);
            el.value = ''; 
        }

        // --- BOILERPLATE ---
        function renderLibrary(){ 
            const c=document.getElementById('lib-list');c.innerHTML=""; 
            for(let k in DB){ 
                let h=document.createElement('h2');
                h.innerText=catMap[k] ? catMap[k].toUpperCase() : k.toUpperCase(); // Proper Naming
                c.appendChild(h); 
                DB[k].forEach(ex=>{ 
                    let i=document.createElement('div');
                    i.className='lib-item';
                    i.innerHTML=`<div><b>${ex.n}</b><br><span style="font-size:10px;color:#888">${catMap[k]||k}</span></div><span class="tag">INFO</span>`; 
                    i.onclick=()=>{sess.preview={n:ex.n,d:ex.d,cat:k}; showInfoAndPause();}; 
                    c.appendChild(i); 
                }) 
            } 
        }
        
        function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(app)); }
        
        function saveLog(){ 
            let d=document.getElementById('log-date').value||new Date().toISOString().split('T')[0];
            let w=document.getElementById('log-weight').value; 
            if(!w)return; 
            
            // 1. Add Log
            app.logs.push({
                date:d, 
                w:w,
                waist: document.getElementById('log-waist').value || 0,
                hips: document.getElementById('log-hips').value || 0,
                chest: document.getElementById('log-chest').value || 0,
                thigh: document.getElementById('log-thigh').value || 0,
                biceps: document.getElementById('log-biceps').value || 0
            }); 
            
            // 2. Sort Logs by Date
            app.logs.sort((a,b) => new Date(a.date) - new Date(b.date));
            
            // 3. Update Profile Weight to latest Log
            app.profile.w = app.logs[app.logs.length-1].w;

            save(); updateUI(); alert("Gespeichert"); 
        }
        
        function renderChart(){ 
            const s=document.getElementById('weight-chart');s.innerHTML=""; 
            if(app.logs.length<2)return; 
            const d=app.logs.slice(-10).map(l=>parseFloat(l.w)); 
            const max=Math.max(...d)+1, min=Math.min(...d)-1; 
            let p=""; d.forEach((v,i)=>p+=`${i*(100/(d.length-1))},${100-((v-min)/(max-min)*100)} `); 
            s.innerHTML=`<polyline points="${p}" fill="none" stroke="#fff" stroke-width="2"/>`; 
        }
        
        function renderHist(){ const l=document.getElementById('hist-list');l.innerHTML=""; app.history.slice(-10).reverse().forEach(h=>{l.innerHTML+=`<div class="card compact-card" style="display:flex; justify-content:space-between; font-size:12px;"><span>Workout (${h.duration}m)</span><span style="color:#666">${new Date(h.date).toLocaleDateString()}</span></div>`}); }
        function updateRangeLbl(){ app.settings.work=document.getElementById('rng-work').value; app.settings.rest=document.getElementById('rng-rest').value; document.getElementById('lbl-work').innerText=app.settings.work; document.getElementById('lbl-rest').innerText=app.settings.rest; save(); }
        function saveSettings(){ app.settings.supps=document.getElementById('tog-supps').checked; app.settings.voice=document.getElementById('tog-voice').checked; save(); }
        function wizSet(k,v,el){ wiz[k]=v; el.parentElement.querySelectorAll('.opt-item').forEach(d=>d.classList.remove('selected')); el.classList.add('selected'); }
        function wizToggle(k,v,el){ if(!wiz[k])wiz[k]=[]; let i=wiz[k].indexOf(v); if(i>-1){wiz[k].splice(i,1);el.classList.remove('selected')}else{wiz[k].push(v);el.classList.add('selected')} }
        function wizNext(s){ document.querySelectorAll('.wiz-step').forEach(ws=>ws.classList.remove('active')); document.getElementById('wiz-'+(s+1)).classList.add('active'); }
        function wizFinish(){ app.profile={w:document.getElementById('wiz-weight').value, a:document.getElementById('wiz-age').value, h:document.getElementById('wiz-height').value, s:wiz.sex}; app.parts=wiz.parts; save(); initApp(); }
        function resetApp(){ if(confirm("Reset?")) { localStorage.clear(); location.reload(); } }
        function exportData(){ const a=document.createElement('a'); a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(app)); a.download="bodypulse_backup.json"; a.click(); }
        function nav(id,el){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); if(id==='tab-library')renderLibrary(); }
        function closePlayer(){ clearInterval(sess.int); location.reload(); }
    </script>
</body>
</html>
