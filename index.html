<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Body Pulse PURE</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' style='background:%23000000'%3E%3Cpath fill='%23ffffff' d='M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-32.1 289.8l-8.8 45.3c-2.1 10.7-16.5 13.6-22.7 4.6l-37.5-54.6c-5.8-8.4-5.4-19.6 1-27.6l74.9-93.6c7.9-9.9 23.4-4.8 24.3 7.9l3.3 46.1 45.1-66.2c6.1-8.9 19.3-8.6 25 0l42.6 62.4c5.8 8.5 5.2 19.7-1.3 27.6l-81.5 98.7c-8.4 10.2-24.6 4.8-25.3-8.3l-2.6-47.5-36.5 5.2z'/%3E%3C/svg%3E">

    <style>
        :root {
            --bg: #000000;
            --surface: #121212;
            --border: #333333;
            --primary: #ffffff;
            --secondary: #888888;
            --accent: #ffffff; /* Reines Wei√ü als Akzent */
            --danger: #cf6679;
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Roboto", sans-serif;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg); color: var(--primary); font-family: var(--font);
            margin: 0; height: 100vh; display: flex; flex-direction: column;
            padding-top: var(--safe-top); overflow: hidden;
        }

        /* --- TYPOGRAPHY --- */
        h1 { font-size: 28px; font-weight: 700; margin: 0 0 5px; letter-spacing: -0.5px; }
        h2 { font-size: 18px; font-weight: 600; margin: 0 0 15px; letter-spacing: 0.5px; text-transform: uppercase; color: var(--secondary); font-size: 12px; }
        .value { font-size: 32px; font-weight: 300; letter-spacing: -1px; }
        .label { color: var(--secondary); font-size: 13px; text-transform: uppercase; margin-bottom: 5px; display: block; }
        
        /* --- LAYOUT --- */
        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; padding-bottom: 100px; overflow-y: auto; }
        .screen.active { display: flex; animation: fade 0.3s ease; }
        
        .card { 
            background: var(--surface); padding: 25px; border: 1px solid var(--border); 
            margin-bottom: 20px; 
        }

        /* --- BUTTONS --- */
        .btn {
            width: 100%; padding: 20px; border: 1px solid var(--primary); background: var(--primary); 
            color: var(--bg); font-size: 16px; font-weight: 700; text-transform: uppercase; 
            letter-spacing: 1px; cursor: pointer; transition: 0.1s; margin-top: 10px;
        }
        .btn:active { transform: scale(0.98); opacity: 0.8; }
        .btn-outline { background: transparent; color: var(--primary); border: 1px solid var(--border); }
        .btn-text { background: transparent; border: none; color: var(--secondary); text-decoration: underline; font-size: 12px; }

        /* --- INPUTS --- */
        input, select {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border);
            color: var(--primary); padding: 15px 0; font-size: 18px; font-family: var(--font);
            border-radius: 0; margin-bottom: 20px;
        }
        input:focus { border-bottom-color: var(--primary); }
        input[type="date"] { color-scheme: dark; } /* Wichtig f√ºr Dark Mode Kalender */
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* --- WIZARD (ONBOARDING) --- */
        .full-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
            z-index: 500; display: none; flex-direction: column; padding: var(--safe-top) 30px 30px 30px;
        }
        .option-list { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .option-item {
            padding: 20px; border: 1px solid var(--border); color: var(--secondary);
            cursor: pointer; transition: 0.2s; font-size: 18px;
        }
        .option-item.selected { border-color: var(--primary); color: var(--primary); background: var(--surface); }

        /* --- PLAYER --- */
        .timer-display { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .time-big { font-size: 140px; font-weight: 100; font-variant-numeric: tabular-nums; line-height: 1; }
        .phase-text { font-size: 24px; font-weight: 700; color: var(--primary); letter-spacing: 4px; margin-top: 20px; }
        .progress-line { width: 100%; height: 2px; background: var(--border); margin-top: 40px; position: relative; }
        .progress-fill { position: absolute; left: 0; top: 0; height: 100%; background: var(--primary); width: 0%; transition: width 1s linear; }

        /* --- HISTORY LIST --- */
        .hist-item { 
            display: flex; justify-content: space-between; padding: 15px 0; 
            border-bottom: 1px solid var(--border); font-size: 14px; 
        }

        /* --- NAV --- */
        .nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
            background: rgba(0,0,0,0.9); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; padding-bottom: var(--safe-bottom); z-index: 100;
        }
        .nav-btn { flex: 1; display: flex; justify-content: center; align-items: center; opacity: 0.4; font-size: 24px; cursor: pointer; }
        .nav-btn.active { opacity: 1; }

        @keyframes fade { from{opacity:0;} to{opacity:1;} }
    </style>
</head>
<body>

    <div id="view-onboarding" class="full-overlay" style="z-index:999;">
        <h1 style="margin-top: 20px;">SETUP</h1>
        <p class="label">Definiere dein Ziel.</p>
        
        <div id="step-1">
            <div class="option-list">
                <div class="option-item" onclick="wizSet('goal', 'lose', this)">ABNEHMEN (HIIT)</div>
                <div class="option-item" onclick="wizSet('goal', 'build', this)">MUSKELAUFBAU (KRAFT)</div>
                <div class="option-item" onclick="wizSet('goal', 'fit', this)">FITNESS & MOBILITY</div>
            </div>
            <button class="btn" style="margin-top:40px" onclick="wizNext(1)">WEITER</button>
        </div>

        <div id="step-2" style="display:none;">
            <p class="label" style="margin-top:20px;">W√§hle Fokus-Zonen (Mehrfachwahl)</p>
            <div class="option-list">
                <div class="option-item" onclick="wizToggle('parts', 'bauch', this)">BAUCH & CORE</div>
                <div class="option-item" onclick="wizToggle('parts', 'beine', this)">BEINE & PO</div>
                <div class="option-item" onclick="wizToggle('parts', 'ober', this)">OBERK√ñRPER</div>
                <div class="option-item" onclick="wizToggle('parts', 'mobility', this)">MOBILITY & STRETCH</div>
            </div>
            <button class="btn" style="margin-top:40px" onclick="wizFinish()">ABSCHLIESSEN</button>
        </div>
    </div>

    <div id="tab-home" class="screen active">
        <h1 style="margin-bottom: 30px;">DASHBOARD</h1>

        <div class="card">
            <h2>HEUTE</h2>
            <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;" id="next-title">Lade Plan...</div>
            <div style="color: var(--secondary); font-size: 14px; margin-bottom: 20px;" id="next-desc">...</div>
            <button class="btn" onclick="openPlayer()">STARTEN</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="card">
                <h2>WORKOUTS</h2>
                <div class="value" id="val-workouts">0</div>
            </div>
            <div class="card">
                <h2>BMI</h2>
                <div class="value" id="val-bmi">--</div>
            </div>
        </div>
    </div>

    <div id="tab-stats" class="screen">
        <h1 style="margin-bottom: 30px;">LOGBUCH</h1>

        <div class="card">
            <h2>NEUER EINTRAG</h2>
            <input type="date" id="log-date">
            <div class="input-row">
                <input type="number" id="log-weight" placeholder="Gewicht (kg)">
                <input type="number" id="log-waist" placeholder="Bauch (cm)">
            </div>
            <button class="btn btn-outline" onclick="saveLog()">SPEICHERN</button>
        </div>

        <div class="card">
            <h2>GEWICHTSVERLAUF</h2>
            <div id="chart-wrap" style="height: 100px; display:flex; align-items:flex-end; gap:5px; margin-top:20px;"></div>
        </div>

        <div class="card">
            <h2>HISTORIE</h2>
            <div id="history-list"></div>
        </div>
    </div>

    <div id="tab-settings" class="screen">
        <h1 style="margin-bottom: 30px;">SYSTEM</h1>

        <div class="card">
            <h2>STAMMDATEN</h2>
            <div class="input-row">
                <input type="number" id="base-height" placeholder="Gr√∂√üe (cm)" onchange="saveBase()">
                <input type="number" id="base-age" placeholder="Alter" onchange="saveBase()">
            </div>
        </div>

        <div class="card">
            <h2>TRAINING</h2>
            <button class="btn btn-outline" onclick="resetOnboarding()">PLAN NEU GENERIEREN</button>
        </div>

        <div class="card">
            <h2>DATEN</h2>
            <button class="btn btn-outline" onclick="exportData()">BACKUP SPEICHERN</button>
            <input type="file" id="import-input" style="display:none" onchange="importData(this)">
            <button class="btn btn-outline" style="margin-top:10px" onclick="document.getElementById('import-input').click()">BACKUP LADEN</button>
            <button class="btn-text" style="width:100%; margin-top:20px; color:var(--danger);" onclick="hardReset()">WERKSEINSTELLUNGEN</button>
        </div>
    </div>

    <div id="view-player" class="full-overlay">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button style="background:none; border:none; color:var(--primary); font-size:24px;" onclick="closePlayer()">‚úï</button>
            <span style="font-size:12px; letter-spacing:1px;" id="round-disp">RUNDE 1/3</span>
            <button style="background:none; border:none; font-size:20px;" onclick="toggleMute()" id="mute-icon">üîä</button>
        </div>

        <div class="timer-display">
            <div class="time-big" id="time-disp">00</div>
            <div class="phase-text" id="phase-disp">READY</div>
            <div class="progress-line"><div class="progress-fill" id="prog-fill"></div></div>
        </div>

        <div style="margin-bottom: 40px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom: 1px solid var(--border); padding-bottom:10px; margin-bottom:10px;">
                <div style="font-size:20px; font-weight:700;" id="ex-name">√úbung</div>
                <button onclick="showInfo()" style="border:1px solid var(--border); background:transparent; color:var(--primary); width:30px; height:30px; border-radius:50%;">i</button>
            </div>
            <div style="color:var(--secondary); font-size:14px;" id="next-ex">Next: ...</div>
            
            <button id="skip-btn" onclick="skipRest()" style="display:none; width:100%; background:var(--border); color:var(--primary); padding:10px; border:none; margin-top:15px;">PAUSE √úBERSPRINGEN</button>
        </div>

        <button class="btn" id="play-btn" onclick="toggleTimer()">START</button>
    </div>

    <div id="view-info" class="full-overlay" style="background: rgba(0,0,0,0.95); z-index: 600;">
        <h1 id="info-title" style="margin-top:40px;">TITEL</h1>
        <p id="info-desc" style="font-size:18px; line-height:1.6; color:var(--secondary); margin-top:20px;">...</p>
        <button class="btn" style="margin-top:auto;" onclick="document.getElementById('view-info').style.display='none'">SCHLIESSEN</button>
    </div>

    <div id="view-rpe" class="full-overlay" style="z-index: 700; justify-content:center;">
        <h1 style="text-align:center;">INTENSIT√ÑT?</h1>
        <p style="text-align:center; color:var(--secondary); margin-bottom:30px;">Wie schwer war das Training (1-10)?</p>
        <input type="range" min="1" max="10" value="5" id="rpe-slider" style="margin-bottom:20px;">
        <div style="display:flex; justify-content:space-between; color:var(--secondary); font-size:12px; margin-bottom:40px;">
            <span>LEICHT</span><span>MAXIMAL</span>
        </div>
        <button class="btn" onclick="finishWorkout()">FERTIG</button>
    </div>

    <nav class="nav">
        <div class="nav-btn active" onclick="nav('tab-home', this)">‚ñ†</div>
        <div class="nav-btn" onclick="nav('tab-stats', this)">lll</div>
        <div class="nav-btn" onclick="nav('tab-settings', this)">‚óè</div>
    </nav>

    <script>
        // --- DATABASE ---
        const DB = {
            bauch: [
                {n:"Crunches", d:"R√ºckenlage. Schultern heben, Bauch fest."},
                {n:"Leg Raises", d:"R√ºckenlage. Beine gestreckt heben."},
                {n:"Plank", d:"Unterarmst√ºtz halten. Gerade Linie."},
                {n:"Russian Twist", d:"Sitzend, F√º√üe hoch, Oberk√∂rper drehen."},
                {n:"Mountain Climbers", d:"St√ºtzposition, Knie zur Brust ziehen."}
            ],
            beine: [
                {n:"Squats", d:"Kniebeugen. Gewicht auf Fersen."},
                {n:"Lunges", d:"Ausfallschritte nach hinten."},
                {n:"Glute Bridges", d:"R√ºckenlage, H√ºfte hochdr√ºcken."},
                {n:"Wall Sit", d:"An Wand sitzen (90 Grad), halten."},
                {n:"Calf Raises", d:"Auf Zehenspitzen stehen, senken."}
            ],
            ober: [
                {n:"Push-Ups", d:"Liegest√ºtze. K√∂rper fest."},
                {n:"Triceps Dips", d:"R√ºcklings an Kante st√ºtzen, beugen."},
                {n:"Superman", d:"Bauchlage, Arme & Beine heben."},
                {n:"Pike Pushups", d:"V-Form (Po hoch), Kopf senken."},
                {n:"Shoulder Taps", d:"Plank, Hand tippt Schulter."}
            ],
            mobility: [
                {n:"Cat-Cow", d:"Vierf√º√üler. R√ºcken rund machen, dann Hohlkreuz."},
                {n:"Child's Pose", d:"Knien, Po auf Fersen, Arme lang vorstrecken."},
                {n:"Hip Flexor Stretch", d:"Ausfallschritt, H√ºfte nach vorne schieben."},
                {n:"Torso Twist", d:"R√ºckenlage, Knie zur Seite fallen lassen."},
                {n:"Forward Fold", d:"Stehend, Oberk√∂rper locker h√§ngen lassen."}
            ]
        };

        // --- STATE ---
        let app = { 
            goal: '', parts: [], 
            plan: [], planIdx: 0, 
            base: { h: '', a: '' },
            logs: [], history: [] // {date, name, rpe}
        };
        
        let sess = { active: [], r: 1, idx: 0, t: 0, max: 0, work: false, run: false, int: null };
        let CFG = { WORK: 40, REST: 20, RNDS: 3 };
        let sound = true; let ac;
        let wiz = { goal: '', parts: [] };

        // --- INIT ---
        window.onload = () => {
            const d = localStorage.getItem('bp_pure');
            if(d) app = JSON.parse(d);
            
            if(!app.goal) {
                document.getElementById('view-onboarding').style.display = 'flex';
            } else {
                initApp();
            }
        };

        function initApp() {
            // Apply Goal Config
            if(app.goal === 'lose') { CFG.WORK = 45; CFG.REST = 15; }
            else if(app.goal === 'build') { CFG.WORK = 40; CFG.REST = 40; }
            else { CFG.WORK = 40; CFG.REST = 20; }
            
            // Set Inputs
            document.getElementById('base-height').value = app.base.h;
            document.getElementById('base-age').value = app.base.a;
            document.getElementById('log-date').valueAsDate = new Date();

            updateUI();
        }

        // --- WIZARD ---
        function wizSet(k, v, el) { 
            wiz[k] = v; 
            el.parentElement.querySelectorAll('div').forEach(d=>d.classList.remove('selected'));
            el.classList.add('selected');
        }
        function wizToggle(k, v, el) {
            if(!wiz[k]) wiz[k] = [];
            const i = wiz[k].indexOf(v);
            if(i > -1) { wiz[k].splice(i,1); el.classList.remove('selected'); }
            else { wiz[k].push(v); el.classList.add('selected'); }
        }
        function wizNext(s) {
            if(!wiz.goal) return alert("Ziel w√§hlen");
            document.getElementById('step-1').style.display='none';
            document.getElementById('step-2').style.display='block';
        }
        function wizFinish() {
            if(wiz.parts.length === 0) return alert("Min 1 Zone");
            app.goal = wiz.goal; app.parts = wiz.parts;
            genPlan();
            document.getElementById('view-onboarding').style.display='none';
            save(); initApp();
        }

        function genPlan() {
            let pool = [];
            app.parts.forEach(p => { if(DB[p]) pool = pool.concat(DB[p]); });
            pool.sort(()=>Math.random()-0.5);
            app.plan = [];
            for(let i=0; i<3; i++) {
                let ex = [];
                for(let j=0; j<5; j++) ex.push(pool[(i*5+j)%pool.length]);
                app.plan.push({ name: "SESSION "+(i+1), ex: ex });
            }
            app.planIdx = 0;
        }

        // --- DASHBOARD & UI ---
        function updateUI() {
            const plan = app.plan[app.planIdx % app.plan.length];
            document.getElementById('next-title').innerText = plan.name;
            document.getElementById('next-desc').innerText = plan.ex.map(e=>e.n).join(', ');
            document.getElementById('val-workouts').innerText = app.history.length;
            
            // BMI
            if(app.base.h && app.logs.length > 0) {
                const w = parseFloat(app.logs[app.logs.length-1].w);
                const h = parseFloat(app.base.h)/100;
                document.getElementById('val-bmi').innerText = (w/(h*h)).toFixed(1);
            }

            renderChart();
            renderHistory();
        }

        // --- PLAYER ENGINE ---
        function openPlayer() {
            sess.active = app.plan[app.planIdx % app.plan.length].ex;
            sess.r = 1; sess.idx = 0;
            document.getElementById('view-player').style.display = 'flex';
            startPhase('PREP');
            if(!ac) ac = new (window.AudioContext||window.webkitAudioContext)();
        }
        function closePlayer() {
            clearInterval(sess.int); sess.run = false;
            document.getElementById('view-player').style.display = 'none';
        }

        function startPhase(type) {
            sess.work = (type === 'WORK');
            const ph = document.getElementById('phase-disp');
            const btn = document.getElementById('skip-btn');
            
            if(type === 'PREP') {
                sess.t = sess.max = CFG.PREP;
                ph.innerText = "READY";
                document.getElementById('ex-name').innerText = sess.active[0].n;
                document.getElementById('next-ex').innerText = "";
                btn.style.display = 'none';
            } else if(type === 'WORK') {
                sess.t = sess.max = CFG.WORK;
                ph.innerText = "WORK";
                ph.style.color = "#ffffff";
                document.getElementById('ex-name').innerText = sess.active[sess.idx].n;
                document.getElementById('next-ex').innerText = "Danach: Pause";
                beep(400, 800);
                btn.style.display = 'none';
            } else {
                sess.t = sess.max = CFG.REST;
                ph.innerText = "REST";
                ph.style.color = "#888888";
                let n = (sess.idx+1 < sess.active.length) ? sess.active[sess.idx+1].n : (sess.r<CFG.RNDS?sess.active[0].n:"FINISH");
                document.getElementById('next-ex').innerText = "Next: " + n;
                beep(600, 300);
                btn.style.display = 'block'; // Show skip button
            }
            drawTimer();
            if(!sess.run) toggleTimer();
        }

        function tick() {
            if(sess.t > 0) {
                sess.t--; drawTimer();
                if(sess.t <= 3) beep(1000, 1000, 0.05);
            } else {
                nextStep();
            }
        }
        
        function nextStep() {
             const ph = document.getElementById('phase-disp').innerText;
             if(ph === "READY") startPhase('WORK');
             else if(sess.work) {
                 if(sess.idx >= sess.active.length-1 && sess.r >= CFG.RNDS) showRPE();
                 else startPhase('REST');
             } else {
                 sess.idx++;
                 if(sess.idx >= sess.active.length) { sess.idx = 0; sess.r++; }
                 document.getElementById('round-disp').innerText = "RUNDE "+sess.r+"/"+CFG.RNDS;
                 startPhase('WORK');
             }
        }

        function skipRest() {
            nextStep();
        }

        function drawTimer() {
            document.getElementById('time-disp').innerText = sess.t;
            const pct = (sess.t / sess.max) * 100;
            document.getElementById('prog-fill').style.width = pct + "%";
        }

        function toggleTimer() {
            const b = document.getElementById('play-btn');
            if(sess.run) {
                clearInterval(sess.int); sess.run = false; b.innerText = "WEITER";
            } else {
                sess.int = setInterval(tick, 1000); sess.run = true; b.innerText = "STOP";
            }
        }
        
        function showRPE() {
            clearInterval(sess.int); sess.run = false;
            document.getElementById('view-player').style.display='none';
            document.getElementById('view-rpe').style.display='flex';
        }

        function finishWorkout() {
            const rpe = document.getElementById('rpe-slider').value;
            app.history.push({ date: new Date().toISOString(), rpe: rpe });
            app.planIdx++;
            save(); updateUI();
            document.getElementById('view-rpe').style.display='none';
        }

        function showInfo() {
            if(sess.run) toggleTimer();
            const e = sess.active[sess.idx];
            document.getElementById('info-title').innerText = e.n;
            document.getElementById('info-desc').innerText = e.d;
            document.getElementById('view-info').style.display = 'flex';
        }

        // --- DATA ---
        function saveLog() {
            const d = document.getElementById('log-date').value;
            const w = document.getElementById('log-weight').value;
            const cm = document.getElementById('log-waist').value;
            if(!d || !w) return;
            app.logs.push({date: d, w: w, cm: cm});
            app.logs.sort((a,b)=>new Date(a.date)-new Date(b.date));
            save(); updateUI(); alert("OK");
        }
        function saveBase() {
            app.base.h = document.getElementById('base-height').value;
            app.base.a = document.getElementById('base-age').value;
            save(); updateUI();
        }

        function renderChart() {
            const c = document.getElementById('chart-wrap'); c.innerHTML = "";
            if(app.logs.length < 2) return c.innerHTML="<p style='width:100%;text-align:center;font-size:12px;color:#444'>Zu wenig Daten</p>";
            const vals = app.logs.map(l=>parseFloat(l.w));
            const min = Math.min(...vals)*0.98; const max = Math.max(...vals)*1.02;
            app.logs.slice(-7).forEach(l => {
                const h = ((parseFloat(l.w)-min)/(max-min))*100;
                const b = document.createElement('div');
                b.style.cssText = `flex:1; background:#fff; height:${h}%; opacity:0.8;`;
                c.appendChild(b);
            });
        }
        
        function renderHistory() {
            const l = document.getElementById('history-list'); l.innerHTML = "";
            app.history.slice().reverse().slice(0,5).forEach(h => {
                const d = new Date(h.date).toLocaleDateString();
                l.innerHTML += `<div class="hist-item"><span>Training</span><span>RPE ${h.rpe} ‚Ä¢ ${d}</span></div>`;
            });
        }

        // --- AUDIO ---
        function toggleMute() { sound = !sound; document.getElementById('mute-icon').style.opacity = sound?1:0.3; }
        function beep(f1, f2, dur=0.2) {
            if(!sound || !ac) return;
            const o = ac.createOscillator(); const g = ac.createGain();
            o.connect(g); g.connect(ac.destination); o.type='sawtooth';
            o.frequency.setValueAtTime(f1, ac.currentTime); o.frequency.exponentialRampToValueAtTime(f2, ac.currentTime+dur);
            g.gain.setValueAtTime(0.3, ac.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime+dur);
            o.start(); o.stop(ac.currentTime+dur);
        }

        // --- UTILS ---
        function nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
        function resetOnboarding() { if(confirm("Plan zur√ºcksetzen?")) { localStorage.clear(); location.reload(); } }
        function hardReset() { if(confirm("ALLES L√ñSCHEN?")) { localStorage.clear(); location.reload(); } }
        function exportData() {
            const a = document.createElement('a'); a.href = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(app));
            a.download = "bodypulse_pure.json"; a.click();
        }
        function importData(el) {
            const r = new FileReader(); r.onload=e=>{ app=JSON.parse(e.target.result); save(); location.reload(); };
            r.readAsText(el.files[0]);
        }
    </script>
</body>
</html>
