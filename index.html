<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BodyPulse">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' style='background:%23000000'%3E%3Cpath fill='%2300f2ea' d='M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-32.1 289.8l-8.8 45.3c-2.1 10.7-16.5 13.6-22.7 4.6l-37.5-54.6c-5.8-8.4-5.4-19.6 1-27.6l74.9-93.6c7.9-9.9 23.4-4.8 24.3 7.9l3.3 46.1 45.1-66.2c6.1-8.9 19.3-8.6 25 0l42.6 62.4c5.8 8.5 5.2 19.7-1.3 27.6l-81.5 98.7c-8.4 10.2-24.6 4.8-25.3-8.3l-2.6-47.5-36.5 5.2z'/%3E%3C/svg%3E">

    <title>Body Pulse</title>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --text: #ffffff;
            --text-dim: #8e8e93;
            --accent: #0a84ff;
            --work: #32d74b;
            --rest: #ff9f0a;
            --font-main: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
            overflow: hidden;
        }

        /* SCREEN MANAGEMENT */
        .screen { display: none; height: 100%; flex-direction: column; }
        .active { display: flex; animation: fadein 0.3s ease; }
        @keyframes fadein { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 10px; }
        h1 { margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
        .btn-icon { background: rgba(255,255,255,0.1); border: none; width: 40px; height: 40px; border-radius: 50%; color: #fff; font-size: 18px; cursor: pointer; display: flex; justify-content: center; align-items: center; }

        /* LISTE DER WORKOUTS */
        .workout-list { flex-grow: 1; overflow-y: auto; padding-bottom: 20px; }
        .card {
            background-color: var(--card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            transition: transform 0.1s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .card:active { transform: scale(0.98); background-color: #2c2c2e; }
        .card h2 { margin: 0 0 5px 0; font-size: 20px; }
        .card p { margin: 0; color: var(--text-dim); font-size: 14px; line-height: 1.4; }
        .card .tag { position: absolute; top: 20px; right: 20px; font-size: 24px; color: var(--text-dim); opacity: 0.3; }

        /* TIMER SCREEN */
        .timer-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-ring { width: 280px; height: 280px; transform: rotate(-90deg); }
        .progress-ring__circle {
            transition: stroke-dashoffset 1s linear, stroke 0.3s;
            transform-origin: 50% 50%;
        }
        
        .timer-value {
            position: absolute;
            font-size: 80px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            letter-spacing: -2px;
        }
        
        .phase-label {
            position: absolute;
            top: 65%;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            color: var(--text-dim);
        }

        .info-area { text-align: center; margin-bottom: 30px; min-height: 80px; position: relative;}
        
        /* Flexbox f√ºr Titel und Info Button */
        .title-row { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px; }
        
        .current-ex { font-size: 24px; font-weight: 700; line-height: 1.2; }
        .next-ex { color: var(--text-dim); font-size: 14px; }

        .btn-info-small {
            background: var(--accent); color: white; border: none; width: 24px; height: 24px; border-radius: 50%;
            font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        .controls { display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; }
        .btn-control {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            font-size: 24px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.1s; color: #000;
        }
        .btn-control:active { transform: scale(0.9); }
        .play { background-color: #fff; }
        .pause { background-color: var(--rest); }

        .state-work .progress-ring__circle { stroke: var(--work); }
        .state-rest .progress-ring__circle { stroke: var(--rest); }
        
        .round-badge { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }

        /* INFO MODAL OVERLAY */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 100;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-card {
            background: var(--card); width: 100%; max-width: 400px; padding: 30px;
            border-radius: 25px; text-align: left; border: 1px solid #333;
        }
        .modal-card h3 { margin-top: 0; color: var(--accent); font-size: 22px; }
        .modal-card p { font-size: 16px; line-height: 1.6; color: #ddd; }
        .btn-close-modal {
            background: #333; color: white; border: none; width: 100%; padding: 15px;
            border-radius: 15px; font-size: 16px; font-weight: bold; margin-top: 20px; cursor: pointer;
        }

        /* DONE SCREEN */
        .done-content { text-align: center; justify-content: center; align-items: center; flex-grow: 1; display: flex; flex-direction: column;}
        .big-icon { font-size: 80px; margin-bottom: 20px; }

    </style>
</head>
<body>

    <div id="home" class="screen active">
        <header>
            <h1>Body Pulse</h1>
            <div style="font-size:12px; color: var(--text-dim);">v3.0</div>
        </header>

        <div class="workout-list">
            <div class="card" onclick="loadWorkout(0)">
                <h2>Tag 1: Po & Beine</h2>
                <p>Squats, Bridges, Lunges, Kicks</p>
                <div class="tag">üçë</div>
            </div>

            <div class="card" onclick="loadWorkout(1)">
                <h2>Tag 2: Oberk√∂rper</h2>
                <p>Push-Ups, Superman, Dips, Angels</p>
                <div class="tag">üí™</div>
            </div>

            <div class="card" onclick="loadWorkout(2)">
                <h2>Tag 3: Core & Bauch</h2>
                <p>Bicycle, Leg Raises, Plank, Twist</p>
                <div class="tag">üî•</div>
            </div>
        </div>
    </div>

    <div id="workout" class="screen">
        <header>
            <button class="btn-icon" onclick="quitWorkout()">‚úï</button>
            <div class="round-badge" id="round-display">Runde 1/3</div>
            <button class="btn-icon" onclick="toggleSound()" id="sound-btn">üîä</button>
        </header>

        <div class="timer-container">
            <svg class="progress-ring" width="280" height="280">
                <circle stroke="#333" stroke-width="12" fill="transparent" r="120" cx="140" cy="140"/>
                <circle id="progress-circle" class="progress-ring__circle" stroke="white" stroke-width="12" stroke-linecap="round" fill="transparent" r="120" cx="140" cy="140"/>
            </svg>
            <div class="timer-value" id="timer-text">00</div>
            <div class="phase-label" id="phase-text">BEREIT</div>
        </div>

        <div class="info-area">
            <div class="title-row">
                <div class="current-ex" id="ex-name">√úbung Name</div>
                <button class="btn-info-small" onclick="showInfo()">i</button>
            </div>
            <div class="next-ex" id="next-ex">N√§chste: ...</div>
        </div>

        <div class="controls">
            <button class="btn-control play" id="main-btn" onclick="toggleTimer()">‚ñ∂</button>
        </div>
    </div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 id="modal-title">√úbungs-Titel</h3>
            <p id="modal-desc">Erkl√§rungstext...</p>
            <button class="btn-close-modal" onclick="closeInfo()">Verstanden</button>
        </div>
    </div>

    <div id="done" class="screen">
        <div class="done-content">
            <div class="big-icon">üéâ</div>
            <h1>Training beendet!</h1>
            <p style="color: var(--text-dim); margin-top: 10px;">Starke Leistung.</p>
            <button class="card" style="margin-top: 40px; width: 100%; text-align: center; background: var(--work); color: black;" onclick="quitWorkout()">
                <h2>Zur√ºck zum Start</h2>
            </button>
        </div>
    </div>

    <script>
        // CONFIG
        const WORK_TIME = 40;
        const REST_TIME = 20;
        const PREP_TIME = 10;
        const TOTAL_ROUNDS = 3;

        // DATA MIT ERKL√ÑRUNGEN
        const plans = [
            { 
                name: "Tag 1", 
                exercises: [
                    { name: "Kniebeugen", desc: "F√º√üe schulterbreit. Po nach hinten unten setzen, als ob da ein Stuhl w√§re. R√ºcken gerade lassen. Gewicht auf den Fersen. Tief runter, und beim Hochkommen Po fest anspannen." },
                    { name: "Glute Bridges", desc: "R√ºckenlage, Beine angewinkelt aufstellen. H√ºfte so hoch wie m√∂glich zur Decke dr√ºcken. Oben den Po maximal zusammenkneifen und kurz halten." },
                    { name: "Reverse Lunges", desc: "Gro√üer Ausfallschritt nach hinten. Das hintere Knie fast bis zum Boden senken. Vorderes Knie bleibt stabil √ºber dem Fu√ü. Abwechselnd links/rechts." },
                    { name: "Donkey Kicks", desc: "Vierf√º√ülerstand. Ein Bein angewinkelt nach oben zur Decke treten (Fu√üsohle zeigt hoch). R√ºcken nicht durchh√§ngen lassen. Nach 20 Sek. Seite wechseln." }
                ] 
            },
            { 
                name: "Tag 2", 
                exercises: [
                    { name: "Liegest√ºtze", desc: "H√§nde etwas breiter als Schultern. K√∂rper bildet eine Linie (Bauch fest!). Brust tief absenken und kraftvoll hochdr√ºcken. Geht auch auf den Knien." },
                    { name: "Superman Pull", desc: "Bauchlage. Arme und Beine schweben √ºber dem Boden. Arme heranziehen (Ellbogen Richtung K√∂rper), als ob du etwas zu dir ziehst. R√ºcken anspannen." },
                    { name: "Trizeps Dips", desc: "R√ºcklings an Stuhl/Bettkante st√ºtzen. Beine lang oder aufgestellt. Po absenken (Ellbogen nach hinten beugen) und wieder hochdr√ºcken." },
                    { name: "Snow Angels", desc: "Bauchlage, Blick zum Boden. Arme gestreckt vom Po √ºber die Seite bis √ºber den Kopf f√ºhren (wie ein Schneeengel), ohne den Boden zu ber√ºhren." }
                ] 
            },
            { 
                name: "Tag 3", 
                exercises: [
                    { name: "Bicycle Crunches", desc: "R√ºckenlage, H√§nde an den Kopf. Rechter Ellbogen zum linken Knie (anderes Bein strecken). Im Wechsel. Schultern bleiben weg vom Boden." },
                    { name: "Leg Raises", desc: "R√ºckenlage, H√§nde flach unter den Po (sch√ºtzt R√ºcken). Gestreckte Beine langsam heben und senken. Nicht ganz ablegen! Bauchspannung halten." },
                    { name: "Plank", desc: "Unterarmst√ºtz. Ellbogen unter den Schultern. K√∂rper ist ein Brett. Bauchnabel fest einziehen, Po nicht durchh√§ngen lassen. Atmen!" },
                    { name: "Russian Twist", desc: "Hinsetzen, Oberk√∂rper leicht zur√ºcklehnen, F√º√üe in die Luft. H√§nde ber√ºhren abwechselnd links und rechts neben der H√ºfte den Boden." }
                ] 
            }
        ];

        // STATE
        let currentPlan = null;
        let round = 1;
        let exIndex = 0;
        let timeLeft = 0;
        let maxTime = 0;
        let isWork = false;
        let isRunning = false;
        let interval = null;
        let soundEnabled = true;

        // UI ELEMENTS
        const timerText = document.getElementById('timer-text');
        const phaseText = document.getElementById('phase-text');
        const circle = document.getElementById('progress-circle');
        const exName = document.getElementById('ex-name');
        const nextExInfo = document.getElementById('next-ex');
        const roundDisplay = document.getElementById('round-display');
        const mainBtn = document.getElementById('main-btn');
        const container = document.getElementById('workout');
        
        // Modal Elements
        const modal = document.getElementById('info-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDesc = document.getElementById('modal-desc');

        // CIRCLE SETUP
        const radius = circle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        circle.style.strokeDasharray = `${circumference} ${circumference}`;
        circle.style.strokeDashoffset = circumference;

        function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function loadWorkout(id) {
            currentPlan = plans[id];
            round = 1;
            exIndex = 0;
            startPhase('PREP');
            switchScreen('workout');
            if ('wakeLock' in navigator) navigator.wakeLock.request('screen').catch(e => {});
        }

        function startPhase(type) {
            isWork = (type === 'WORK');
            
            if (type === 'PREP') {
                timeLeft = PREP_TIME; maxTime = PREP_TIME;
                phaseText.innerText = "BEREIT MACHEN";
                exName.innerText = currentPlan.exercises[0].name;
                nextExInfo.innerText = "";
                container.classList.remove('state-work', 'state-rest');
            } else if (type === 'WORK') {
                timeLeft = WORK_TIME; maxTime = WORK_TIME;
                phaseText.innerText = "GO / ARBEITEN";
                exName.innerText = currentPlan.exercises[exIndex].name;
                nextExInfo.innerText = "Danach: Pause";
                container.classList.add('state-work'); container.classList.remove('state-rest');
                playBeep(800, 'start');
            } else {
                timeLeft = REST_TIME; maxTime = REST_TIME;
                phaseText.innerText = "PAUSE";
                exName.innerText = "Erholen";
                
                let nextIdx = exIndex + 1;
                let nextTxt = "";
                if (nextIdx < currentPlan.exercises.length) nextTxt = currentPlan.exercises[nextIdx].name;
                else if (round < TOTAL_ROUNDS) nextTxt = currentPlan.exercises[0].name;
                else nextTxt = "Training beendet";
                
                nextExInfo.innerText = "N√§chste: " + nextTxt;
                container.classList.add('state-rest'); container.classList.remove('state-work');
                playBeep(400, 'end');
            }
            updateTimerUI();
            if (!isRunning) toggleTimer();
        }

        function tick() {
            if (timeLeft > 0) {
                timeLeft--;
                updateTimerUI();
                if (timeLeft > 0 && timeLeft <= 3) playBeep(600, 'short');
            } else {
                nextPhase();
            }
        }

        function nextPhase() {
            if (phaseText.innerText === 'BEREIT MACHEN') {
                 startPhase('WORK');
            } else if (!isWork) {
                startPhase('WORK');
            } else {
                // Work done
                if (isWork) {
                    exIndex++;
                    if (exIndex >= currentPlan.exercises.length) {
                        exIndex = 0; round++;
                        if (round > TOTAL_ROUNDS) { finish(); return; }
                    }
                }
                startPhase('REST'); 
            }
            roundDisplay.innerText = `Runde ${round}/${TOTAL_ROUNDS}`;
        }

        function updateTimerUI() {
            timerText.innerText = timeLeft;
            let percent = (timeLeft / maxTime) * 100;
            setProgress(100 - percent); 
        }

        function toggleTimer() {
            if (isRunning) {
                clearInterval(interval);
                isRunning = false;
                mainBtn.innerText = "‚ñ∂";
                mainBtn.classList.remove('pause'); mainBtn.classList.add('play');
            } else {
                interval = setInterval(tick, 1000);
                isRunning = true;
                mainBtn.innerText = "‚è∏";
                mainBtn.classList.remove('play'); mainBtn.classList.add('pause');
                initAudio();
            }
        }

        // INFO MODAL LOGIC
        function showInfo() {
            // Timer pausieren
            if (isRunning) toggleTimer();
            
            // Text setzen
            // Wenn Pause ist, zeige Info zur N√ÑCHSTEN √úbung, sonst zur aktuellen
            let exToShow = currentPlan.exercises[exIndex];
            
            // Spezialfall: Wenn wir gerade Pause machen, wollen wir oft wissen, was als n√§chstes kommt.
            // Aber der User klickt vielleicht auf "Info", um die *kommende* √úbung zu sehen.
            // Da im UI "N√§chste: ..." steht, lassen wir die Info beim Klick oben sich auf den Namen oben beziehen.
            // Oben steht "Erholen" in der Pause? Nein, wir wollen die Info der n√§chsten √úbung sehen.
            // Der Einfachheit halber: Der Info-Button bezieht sich auf die √úbung, die gerade "dran" ist oder "gleich kommt".
            
            // Wenn Pause ist, ist exIndex schon auf die n√§chste √úbung hochgez√§hlt worden in nextPhase(), 
            // ABER exName zeigt "Erholen". Wir wollen die Info zur N√ÑCHSTEN √úbung.
            // In startPhase('REST') haben wir exIndex noch nicht erh√∂ht? Doch, wir erh√∂hen VOR startPhase('REST').
            // Also ist exIndex korrekt auf die n√§chste √úbung gesetzt.
            
            if (phaseText.innerText === "PAUSE" || phaseText.innerText === "Erholen") {
                 // exIndex zeigt auf die n√§chste √úbung
                 modalTitle.innerText = "N√§chste: " + exToShow.name;
            } else {
                 modalTitle.innerText = exToShow.name;
            }
            
            modalDesc.innerText = exToShow.desc;
            modal.style.display = 'flex';
        }

        function closeInfo() {
            modal.style.display = 'none';
        }

        function finish() {
            clearInterval(interval);
            switchScreen('done');
            playBeep(1000, 'success');
        }

        function quitWorkout() {
            clearInterval(interval);
            isRunning = false;
            switchScreen('home');
        }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // AUDIO
        let audioCtx;
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playBeep(freq, type) {
            if (!soundEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            
            if (type === 'success') {
                osc.start(now); osc.stop(now + 0.1);
                setTimeout(() => playBeep(1200, 'short'), 150);
                setTimeout(() => playBeep(1500, 'short'), 300);
                return;
            }
            osc.start(now);
            gain.gain.exponentialRampToValueAtTime(0.00001, now + (type === 'short' ? 0.1 : 0.5));
            osc.stop(now + (type === 'short' ? 0.1 : 0.5));
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-btn').innerText = soundEnabled ? "üîä" : "üîá";
            document.getElementById('sound-btn').style.opacity = soundEnabled ? "1" : "0.5";
        }
    </script>
</body>
</html>
