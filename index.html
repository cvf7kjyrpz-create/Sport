<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Body Pulse V20 - Clean & Pro</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' style='background:%23000000'%3E%3Cpath fill='%23ffffff' d='M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-32.1 289.8l-8.8 45.3c-2.1 10.7-16.5 13.6-22.7 4.6l-37.5-54.6c-5.8-8.4-5.4-19.6 1-27.6l74.9-93.6c7.9-9.9 23.4-4.8 24.3 7.9l3.3 46.1 45.1-66.2c6.1-8.9 19.3-8.6 25 0l42.6 62.4c5.8 8.5 5.2 19.7-1.3 27.6l-81.5 98.7c-8.4 10.2-24.6 4.8-25.3-8.3l-2.6-47.5-36.5 5.2z'/%3E%3C/svg%3E">

    <style>
        /* =========================================
           BASIS STYLES
           ========================================= */
        :root {
            --bg: #000000;
            --surface: #111111;
            --surface-light: #1c1c1e;
            --border: #2c2c2e;
            --primary: #ffffff;
            --accent: #32d74b;
            --secondary: #8e8e93;
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Roboto", sans-serif;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        html, body { 
            position: fixed; 
            overflow: hidden; 
            width: 100%; 
            height: 100%; 
            margin: 0;
            padding: 0;
            touch-action: none;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
            user-select: none; 
        }
        
        body {
            background-color: var(--bg); 
            color: var(--primary); 
            font-family: var(--font);
            display: flex; 
            flex-direction: column;
            padding-top: var(--safe-top);
        }

        /* =========================================
           TYPOGRAPHIE
           ========================================= */
        h1 { 
            font-size: 24px; 
            font-weight: 800; 
            margin: 0 0 5px; 
            letter-spacing: 0.5px; 
        }

        h2 { 
            font-size: 11px; 
            font-weight: 700; 
            margin: 0 0 10px; 
            letter-spacing: 1.5px; 
            text-transform: uppercase; 
            color: var(--secondary); 
        }

        .val-big { 
            font-size: 24px; 
            font-weight: 700; 
            letter-spacing: -0.5px; 
        }

        .label { 
            color: var(--secondary); 
            font-size: 10px; 
            text-transform: uppercase; 
            display: block; 
            margin-bottom: 3px; 
        }

        /* =========================================
           LAYOUT CONTAINER
           ========================================= */
        .screen { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
            padding: 15px; 
            padding-bottom: 100px; 
            overflow-y: auto; 
            z-index: 10; 
            position: relative;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }
        
        .screen.active { 
            display: flex; 
            animation: fade 0.3s ease; 
        }
        
        .card { 
            background: var(--surface); 
            padding: 15px; 
            border: 1px solid var(--border); 
            margin-bottom: 10px; 
            border-radius: 14px;
        }

        .compact-card {
            padding: 12px;
            margin-bottom: 8px;
        }

        .stat-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 10px; 
        }
        
        .stat-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .input-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-bottom: 15px; 
        }

        /* =========================================
           ELEMENTS
           ========================================= */
        .lib-item { 
            padding: 18px; 
            background: var(--surface-light); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            margin-bottom: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
        }
        .lib-item:active { background: var(--border); }

        .tag { 
            font-size: 9px; 
            padding: 4px 8px; 
            background: var(--accent); 
            color: #000; 
            border-radius: 6px; 
            font-weight: 800; 
            text-transform: uppercase; 
        }

        .btn {
            width: 100%; 
            padding: 15px; 
            border: none; 
            background: var(--primary); 
            color: var(--bg); 
            font-size: 14px; 
            font-weight: 700; 
            text-transform: uppercase; 
            cursor: pointer; 
            transition: 0.1s; 
            margin-top: 8px; 
            letter-spacing: 0.5px; 
            border-radius: 10px; 
            text-align: center;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        .btn-outline { 
            background: transparent; 
            color: var(--primary); 
            border: 1px solid var(--border); 
        }

        .btn-close { 
            background: transparent; 
            border: none; 
            font-size: 24px; 
            color: var(--secondary); 
            padding: 10px; 
        }

        input:not([type="checkbox"]):not([type="range"]):not([type="date"]) {
            width: 100%; 
            background: var(--surface-light); 
            border: 1px solid var(--border);
            color: var(--primary); 
            padding: 12px; 
            font-size: 16px; 
            font-family: var(--font);
            border-radius: 10px; 
            margin-bottom: 0; 
            appearance: none;
        }

        input[type="date"] {
            width: 100%; 
            background: var(--surface-light); 
            border: 1px solid var(--border);
            color: var(--primary); 
            padding: 12px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            appearance: none; 
            font-family: var(--font);
        }

        .msg-input {
            width: 100%;
            background: transparent;
            border: 1px dashed var(--secondary);
            color: var(--accent);
            font-size: 18px;
            font-weight: bold;
            font-style: italic;
            text-align: center;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 10px;
            outline: none;
        }
        .msg-input::placeholder { color: #444; font-weight: normal; }

        /* =========================================
           NEUER SLIDER / TOGGLE SWITCH
           ========================================= */
        .toggle-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3a3a3c; /* Grau (Aus) */
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent); /* Gr√ºn (An) */
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        input[type="range"] { 
            width: 100%; 
            margin: 10px 0; 
            accent-color: var(--primary); 
            cursor: pointer;
        }

        /* =========================================
           CHARTS
           ========================================= */
        .chart-container { 
            width: 100%; 
            height: 150px; 
            position: relative; 
            margin-top: 10px; 
            border-bottom: 1px solid var(--border); 
            border-left: 1px solid var(--border); 
        }

        svg.chart { width: 100%; height: 100%; overflow: visible; }
        polyline { fill: none; stroke: var(--primary); stroke-width: 2; vector-effect: non-scaling-stroke; }

        /* =========================================
           OVERLAYS
           ========================================= */
        .full-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
            z-index: 2000; display: none; flex-direction: column; padding: var(--safe-top) 25px 25px 25px;
            overflow-y: auto;
        }

        .wiz-step { display: none; flex-direction: column; height: 100%; }
        .wiz-step.active { display: flex; animation: slide 0.3s ease; }
        
        .opt-item { 
            padding: 22px; 
            border: 1px solid var(--border); 
            margin-bottom: 12px; 
            cursor: pointer; 
            border-radius: 12px; 
            background: var(--surface); 
            font-weight: 500;
        }
        .opt-item.selected { border-color: var(--primary); background: var(--surface-light); color: var(--primary); }

        /* =========================================
           PLAYER COMPONENTS (CLEAN - NO STICKMAN)
           ========================================= */
        .timer-wrap { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
        }

        .progress-ring { 
            width: 260px; 
            height: 260px; 
            transform: rotate(-90deg); 
        }

        .progress-ring__circle { 
            transition: stroke-dashoffset 1.0s linear; 
            transform-origin: 50% 50%; 
        }

        .time-center { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            text-align: center; 
        }

        .time-huge { 
            font-size: 80px; 
            font-weight: 700; 
            font-family: monospace; 
            letter-spacing: -3px; 
            line-height: 1; 
        }

        .phase-lbl { 
            font-size: 16px; 
            font-weight: 600; 
            letter-spacing: 4px; 
            display: block; 
            color: var(--accent); 
            margin-top: 10px;
        }

        /* =========================================
           CHECK ITEMS (SUPPLEMENTS)
           ========================================= */
        .check-item { 
            padding: 15px; 
            border: 1px solid var(--border); 
            background: var(--surface);
            border-radius: 10px;
            font-size: 16px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.1s ease;
        }
        .check-item:active { transform: scale(0.98); }

        .check-box-visual {
            width: 28px; height: 28px; border: 2px solid var(--secondary); border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; color: transparent; background: transparent; transition: all 0.2s ease;
        }

        .check-item.checked { border-color: var(--accent); background: rgba(50, 215, 75, 0.05); }
        .check-item.checked .check-box-visual { background: var(--accent); border-color: var(--accent); color: #000; }

        .hist-item { 
            display: flex; justify-content: space-between; padding: 15px 0; 
            border-bottom: 1px solid var(--border); font-size: 13px; 
        }

        /* =========================================
           NAVIGATION BAR
           ========================================= */
        .nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; 
            background: rgba(0,0,0,0.95); border-top: 1px solid var(--border); 
            backdrop-filter: blur(20px); display: flex; justify-content: space-around; 
            padding-bottom: var(--safe-bottom); z-index: 1000;
        }
        .nav-btn { 
            flex: 1; display: flex; justify-content: center; align-items: center; 
            opacity: 0.4; font-size: 22px; cursor: pointer; transition: 0.2s; color: white; 
        }
        .nav-btn.active { opacity: 1; transform: scale(1.1); color: var(--primary); }

        @keyframes fade { from{opacity:0;} to{opacity:1;} }
        @keyframes slide { from{opacity:0; transform:translateX(20px);} to{opacity:1; transform:translateX(0);} }
    </style>
</head>
<body>

    <div id="view-onboarding" class="full-overlay">
        
        <div id="wiz-1" class="wiz-step active">
            <h1 style="margin-top:20px;">ZIELSETZUNG</h1>
            <p class="label">Schritt 1 von 3</p>
            <div style="margin-top:20px;">
                <div class="opt-item" onclick="wizSet('goal', 'lose', this)">ABNEHMEN</div>
                <div class="opt-item" onclick="wizSet('goal', 'build', this)">MUSKELAUFBAU</div>
                <div class="opt-item" onclick="wizSet('goal', 'fit', this)">ALLG. FITNESS</div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizNext(1)">WEITER</button>
        </div>

        <div id="wiz-2" class="wiz-step">
            <h1 style="margin-top:20px;">FOKUS ZONEN</h1>
            <p class="label">Mehrfachwahl m√∂glich</p>
            <div style="margin-top:20px;">
                <div class="opt-item" onclick="wizToggle('parts', 'bauch', this)">BAUCH & CORE</div>
                <div class="opt-item" onclick="wizToggle('parts', 'beine', this)">BEINE & PO</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ober', this)">OBERK√ñRPER</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ruecken', this)">R√úCKEN (NEU)</div>
                <div class="opt-item" onclick="wizToggle('parts', 'stuhl', this)">STUHL / SOFA</div>
                <div class="opt-item" onclick="wizToggle('parts', 'ganz', this)">GANZK√ñRPER (NEU)</div>
                <div class="opt-item" onclick="wizToggle('parts', 'cardio', this)">CARDIO</div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizNext(2)">WEITER</button>
        </div>

        <div id="wiz-3" class="wiz-step">
            <h1 style="margin-top:20px;">STAMMDATEN</h1>
            <p class="label">F√ºr deine Statistik</p>
            <div class="card" style="margin-top:20px;">
                <input type="number" id="wiz-age" placeholder="Alter">
                <div class="input-row">
                    <input type="number" id="wiz-height" placeholder="Gr√∂√üe (cm)">
                    <input type="number" id="wiz-weight" placeholder="Gewicht (kg)">
                </div>
            </div>
            <button class="btn" style="margin-top:auto" onclick="wizFinish()">SETUP ABSCHLIESSEN</button>
        </div>
    </div>

    <div id="tab-home" class="screen active" style="padding:10px;">
        <div style="display:flex; justify-content:space-between; align-items:end; margin-bottom:10px;">
            <div>
                <span class="label" id="greeting">HALLO</span>
                <h1>COCKPIT</h1>
            </div>
            <div style="font-size:12px; background:var(--surface-light); border:1px solid var(--border); padding:5px 12px; border-radius:20px;" id="lvl-badge">LVL 1</div>
        </div>

        <div class="stat-grid">
            <div class="card compact-card" style="margin:0; text-align:center;">
                <span class="label">LIFETIME KCAL</span>
                <span class="val-big" id="disp-total-kcal">0</span>
            </div>
            <div class="card compact-card" style="margin:0; text-align:center;">
                <span class="label">BMI INDEX</span>
                <span class="val-big" id="disp-bmi">0.0</span>
            </div>
        </div>

        <div class="card compact-card">
            <h2 style="margin-bottom:8px; text-align:center;">TRAININGSZEIT (MIN)</h2>
            <div class="stat-grid-3">
                <div style="text-align:center;">
                    <span class="label">WOCHE</span>
                    <div class="val-big" id="min-week">0</div>
                </div>
                <div style="text-align:center;">
                    <span class="label">MONAT</span>
                    <div class="val-big" id="min-month">0</div>
                </div>
                <div style="text-align:center;">
                    <span class="label">JAHR</span>
                    <div class="val-big" id="min-year">0</div>
                </div>
            </div>
        </div>

        <div class="card compact-card" style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <span class="label">WOCHENZIEL</span>
                <div class="val-big" id="week-val">0 / 3</div>
            </div>
            <div style="position:relative; width:50px; height:50px;">
                <svg width="50" height="50" style="transform: rotate(-90deg);">
                    <circle stroke="#222" stroke-width="4" fill="transparent" r="20" cx="25" cy="25"/>
                    <circle id="week-circle" stroke="white" stroke-width="4" stroke-linecap="round" fill="transparent" r="20" cx="25" cy="25" stroke-dasharray="125 125" stroke-dashoffset="125"/>
                </svg>
            </div>
        </div>

        <div class="card compact-card" style="border: 1px solid var(--primary);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin:0; color:white;">STARTEN</h2>
                <span id="last-workout" style="font-size:9px; color:#666;">...</span>
            </div>
            
            <p class="label" style="margin-top:8px;">Dauer w√§hlen:</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-top:5px;">
                <button class="btn btn-outline" style="margin:0; padding:10px; font-size:12px;" id="dur-10" onclick="setWorkoutDuration(10, this)">10 MIN</button>
                <button class="btn btn-outline" style="margin:0; padding:10px; font-size:12px;" id="dur-20" onclick="setWorkoutDuration(20, this)">20 MIN</button>
                <button class="btn btn-outline" style="margin:0; padding:10px; font-size:12px;" id="dur-30" onclick="setWorkoutDuration(30, this)">30 MIN</button>
            </div>
            
            <button class="btn" style="margin-top:10px; padding:12px;" onclick="openPlayer()">LOS GEHT'S</button>
        </div>

        <button class="btn btn-outline" style="margin-top:5px; border-style:dashed; opacity:0.7;" onclick="openSuppsManually()">SUPPLEMENTE & NOTIZ</button>
    </div>

    <div id="tab-library" class="screen">
        <h1>BIBLIOTHEK</h1>
        <p class="label" style="margin-bottom:20px;">Alle √úbungen im √úberblick</p>
        <div id="lib-list">
            </div>
    </div>

    <div id="tab-stats" class="screen">
        <h1>TRACKING</h1>
        
        <div class="card">
            <h2>GEWICHTSKURVE</h2>
            <div class="chart-container">
                <svg class="chart" id="weight-chart" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
            </div>
        </div>
        
        <div class="card">
            <h2>MESSUNG EINTRAGEN</h2>
            <input type="date" id="log-date">
            
            <div class="input-row">
                <div>
                    <span class="label">Gewicht (kg)</span>
                    <input type="number" id="log-weight" step="0.1" placeholder="0.0">
                </div>
                <div>
                    <span class="label">Bauch (cm)</span>
                    <input type="number" id="log-waist" placeholder="0">
                </div>
            </div>
            
            <div class="input-row">
                <div>
                    <span class="label">Po/H√ºfte (cm)</span>
                    <input type="number" id="log-hips" placeholder="0">
                </div>
                <div>
                    <span class="label">Brust (cm)</span>
                    <input type="number" id="log-chest" placeholder="0">
                </div>
            </div>
            
             <div class="input-row">
                <div>
                    <span class="label">Oberschenkel (cm)</span>
                    <input type="number" id="log-thigh" placeholder="0">
                </div>
                <div></div>
            </div>
            
            <button class="btn btn-outline" onclick="saveLog()">WERTE SPEICHERN</button>
        </div>
        
        <div class="card">
            <h2>HISTORIE</h2>
            <div id="hist-list"></div>
        </div>
    </div>

    <div id="tab-settings" class="screen">
        <h1>SYSTEM</h1>
        
        <div class="card">
            <h2>ZIEL & TIMER</h2>
            <div class="toggle-row"><span>Wochenziel: <b id="lbl-goal">3</b> x</span></div>
            <input type="range" min="1" max="7" id="rng-goal" oninput="updateRangeLbl()">
            
            <div class="toggle-row"><span>Belastung: <b id="lbl-work">40</b> Sek</span></div>
            <input type="range" min="20" max="90" step="5" id="rng-work" oninput="updateRangeLbl()" onchange="saveSettings()">
            
            <div class="toggle-row"><span>Pause: <b id="lbl-rest">20</b> Sek</span></div>
            <input type="range" min="10" max="60" step="5" id="rng-rest" oninput="updateRangeLbl()" onchange="saveSettings()">
        </div>

        <div class="card">
            <h2>OPTIONEN</h2>
            <div class="toggle-row">
                <span style="font-size:16px;">Supplements Erinnerung</span>
                <label class="switch">
                    <input type="checkbox" id="tog-supps" onchange="toggleSuppsSetting()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="card">
            <h2>FOKUS & ZIELE</h2>
            <p class="label">Aktuelles Ziel:</p>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-goal-lose" onclick="updateAppGoal('lose')">ABNEHMEN</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-goal-build" onclick="updateAppGoal('build')">MUSKELN</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-goal-fit" onclick="updateAppGoal('fit')">FITNESS</button>
            </div>
            <p class="label">Fokus Zonen:</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-bauch" onclick="updateAppPart('bauch')">BAUCH</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-beine" onclick="updateAppPart('beine')">BEINE</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-ober" onclick="updateAppPart('ober')">OBERK√ñRPER</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-ruecken" onclick="updateAppPart('ruecken')">R√úCKEN (NEU)</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-stuhl" onclick="updateAppPart('stuhl')">STUHL</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-ganz" onclick="updateAppPart('ganz')">GANZK√ñRPER (NEU)</button>
                <button class="btn btn-outline" style="font-size:10px; padding:10px;" id="set-part-cardio" onclick="updateAppPart('cardio')">CARDIO</button>
            </div>
        </div>

        <div class="card">
            <h2>DATEN & BACKUP</h2>
            <div class="input-row">
                <div><span class="label">Gr√∂√üe (cm)</span><input type="number" id="set-height" onchange="saveSettings()"></div>
                <div><span class="label">Alter</span><input type="number" id="set-age" onchange="saveSettings()"></div>
            </div>
            <button class="btn btn-outline" onclick="exportData()">BACKUP SPEICHERN</button>
            <input type="file" id="import-input" style="display:none" onchange="importData(this)">
            <button class="btn btn-outline" style="margin-top:10px" onclick="document.getElementById('import-input').click()">BACKUP LADEN</button>
            <button class="btn btn-outline" style="margin-top:20px; color:#ff453a; border-color:#ff453a;" onclick="resetApp()">WERKSEINSTELLUNGEN</button>
        </div>
    </div>

    <div id="view-player" class="full-overlay" style="background:#000; z-index:3000;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button class="btn-close" onclick="closePlayer()">‚úï</button>
            <span id="round-disp">RUNDE 1</span>
            <button class="btn-close" onclick="toggleMute()" id="mute-icon">üîä</button>
        </div>
        
        <div class="timer-wrap">
            <svg class="progress-ring" width="260" height="260">
                <circle stroke="#222" stroke-width="8" fill="transparent" r="115" cx="130" cy="130"/>
                <circle id="progress-circle" class="progress-ring__circle" stroke="white" stroke-width="8" stroke-linecap="round" fill="transparent" r="115" cx="130" cy="130"/>
            </svg>
            
            <div class="time-center">
                <div class="time-huge" id="time-disp">00</div>
                <span id="phase-disp" class="phase-lbl">READY</span>
            </div>
        </div>
        
        <div style="text-align:center; margin-bottom:40px;">
            <div id="ex-name" style="font-size:24px; font-weight:700;">√úbung</div>
            <button class="btn-outline" id="info-btn" style="padding:10px 20px; font-size:12px; margin-top:15px; border-radius:20px;" onclick="showInfoAndPause()">ANLEITUNG</button>
        </div>
        
        <button class="btn" id="play-btn" onclick="toggleTimer()">START</button>
    </div>

    <div id="view-info" class="full-overlay" style="z-index:5000; background:rgba(0,0,0,0.98);">
        <button class="btn-close" onclick="closeInfoAndResume()">‚úï</button>
        <h1 id="info-title" style="margin-top:40px;">√úBUNG</h1>
        <p id="info-desc" style="font-size:18px; line-height:1.6; color:var(--secondary); margin-top:20px;"></p>
    </div>
    
    <div id="view-rpe" class="full-overlay" style="z-index: 4000; justify-content:center;">
        <h1 style="text-align:center;">INTENSIT√ÑT (1-10)</h1>
        <input type="range" min="1" max="10" value="5" id="rpe-slider" style="margin: 40px 0;">
        <button class="btn" onclick="finishWorkout()">ABSCHLIESSEN</button>
    </div>
    
    <div id="view-supps" class="full-overlay" style="z-index: 5000; justify-content:center; text-align:center;">
        <button class="btn-close" style="position:absolute; top:var(--safe-top); right:25px;" onclick="document.getElementById('view-supps').style.display='none'">‚úï</button>

        <h1 style="margin-bottom:10px; margin-top:40px;">POST-WORKOUT</h1>
        
        <div id="supp-custom-msg" style="display:none; margin-bottom:20px; font-size:20px; color:var(--accent); font-weight:bold; font-style:italic;"></div>
        
        <p class="label" style="margin-bottom:10px;">Deine Notiz / Motivation:</p>
        
        <input type="text" class="msg-input" id="supp-live-msg" placeholder="Tippe hier deine Nachricht ein..." oninput="saveSuppMsg(this)">
        
        <p class="label" style="margin-bottom:20px; margin-top:20px;">Abhaken was erledigt ist</p>
        
        <div id="check-list-container" style="text-align:left; display:inline-block; max-width: 300px; width:100%;">
            <div class="check-item" onclick="toggleCheck(this, 0)">
                <div class="check-box-visual">‚úî</div>
                <div>ü•§ Eiwei√ü Shake</div>
            </div>
            
            <div class="check-item" onclick="toggleCheck(this, 1)">
                <div class="check-box-visual">‚úî</div>
                <div>‚ö° Kreatin</div>
            </div>
            
            <div class="check-item" onclick="toggleCheck(this, 2)">
                <div class="check-box-visual">‚úî</div>
                <div>üíä Magnesium</div>
            </div>
            
            <div class="check-item" onclick="toggleCheck(this, 3)">
                <div class="check-box-visual">‚úî</div>
                <div>üî© Eisen / Vitamine</div>
            </div>
            
            <div class="check-item" onclick="toggleCheck(this, 4)">
                <div class="check-box-visual">‚úî</div>
                <div>üíß 0.5L Wasser</div>
            </div>
        </div>
        
        <button class="btn" style="margin-top:50px;" onclick="location.reload()">FERTIG</button>
    </div>

    <nav class="nav">
        <div class="nav-btn active" onclick="nav('tab-home', this)">‚ñ†</div>
        <div class="nav-btn" onclick="nav('tab-library', this)">üìñ</div>
        <div class="nav-btn" onclick="nav('tab-stats', this)">lll</div>
        <div class="nav-btn" onclick="nav('tab-settings', this)">‚óè</div>
    </nav>

    <script>
        const STORE_KEY = 'bp_clean_pro_v800';
        
        // --- 1. DATENBANK (INKL. R√úCKEN & GANZK√ñRPER) ---
        const DB = {
            bauch: [
                {n:"Crunches", d:"Klassiker: R√ºckenlage, Beine aufgestellt. Hebe nur die Schulterbl√§tter vom Boden ab, indem du den Bauch fest anspannst. Blick schr√§g zur Decke. Nicht am Kopf ziehen! Ausatmen beim Hochgehen."},
                {n:"Leg Raises", d:"R√ºckenlage, H√§nde zur St√ºtze flach unter den Po. Hebe die gestreckten Beine langsam an und senke sie kontrolliert ab. Wichtig: Der untere R√ºcken muss permanent Kontakt zum Boden haben!"},
                {n:"Plank", d:"Der Unterarmst√ºtz. Ellbogen unter den Schultern. K√∂rper bildet ein Brett. Spanne Po und Bauch maximal an. Nicht durchh√§ngen! Halte die Position so ruhig wie m√∂glich."},
                {n:"Russian Twist", d:"Setz dich hin, lehne den Oberk√∂rper leicht zur√ºck (R√ºcken gerade!). F√º√üe leicht anheben. Rotiere den Oberk√∂rper und ber√ºhre abwechselnd links und rechts den Boden."},
                {n:"Bicycle Crunches", d:"R√ºckenlage. H√§nde an die Schl√§fen. F√ºhre den rechten Ellbogen zum linken Knie, w√§hrend das rechte Bein streckt. Dann fliegender Wechsel. Langsam und kontrolliert!"}
            ],
            beine: [
                {n:"Squats", d:"Kniebeugen: Stand etwas breiter als H√ºfte. Gehe tief, als w√ºrdest du dich auf einen Stuhl setzen. Gewicht auf die Fersen. R√ºcken gerade lassen. Knie nicht nach innen knicken lassen."},
                {n:"Lunges", d:"Ausfallschritte: Gro√üer Schritt nach vorn. Senke das hintere Knie bis kurz vor den Boden. Beide Beine sollten ca. 90 Grad haben. Dr√ºck dich √ºber die vordere Ferse wieder hoch."},
                {n:"Glute Bridges", d:"R√ºckenlage, F√º√üe nah am Po aufstellen. Dr√ºcke das Becken so hoch es geht zur Decke. Oben den Po fest zusammenkneifen und kurz halten. Langsam ablassen."},
                {n:"Wall Sit", d:"Wandsitz: Lehne dich mit dem R√ºcken flach an eine Wand und rutsche runter, bis deine Beine im 90-Grad-Winkel sind. H√§nde nicht auf den Beinen abst√ºtzen! Halten."},
                {n:"Calf Raises", d:"Wadenheben: Stell dich aufrecht hin (evtl. an Wand festhalten). Dr√ºcke dich hoch auf die Zehenspitzen, halte kurz, und senke die Fersen langsam wieder ab ohne abzusetzen."},
                {n:"Sumo Squats", d:"Breiter Stand, Zehen zeigen nach au√üen. Gehe tief. Sp√ºre die Innenseite der Oberschenkel."}
            ],
            ober: [
                {n:"Push-Ups", d:"Liegest√ºtz: H√§nde unter den Schultern. K√∂rper fest wie ein Brett. Brust bis fast zum Boden senken. Ellbogen zeigen eher nach hinten (Pfeilform), nicht 90 Grad zur Seite (T-Form)."},
                {n:"Dips", d:"Trizeps-Dips: St√ºtze dich an einer stabilen Kante (Bett/Stuhl) ab. Beine gestreckt oder gebeugt. Senke den Po ab, indem du die Arme beugst. Dr√ºck dich wieder hoch."},
                {n:"Shoulder Taps", d:"Ausgangsposition: Hohe Plank (Liegest√ºtz-Position). Ber√ºhre abwechselnd mit der linken Hand die rechte Schulter und umgekehrt. Versuche dabei, die H√ºfte ganz ruhig zu halten."},
                {n:"Pike Pushups", d:"Schulter-Pushup: Po weit in die H√∂he strecken (umgekehrtes V). Beine gestreckt. Beuge die Arme und senke den Kopf Richtung Boden zwischen die H√§nde. Dr√ºck dich raus."},
                {n:"Diamond Pushups", d:"Schwere Variante: H√§nde unter der Brust so zusammenlegen, dass Daumen und Zeigefinger ein Dreieck bilden. Gehe tief. Geht extrem auf den Trizeps."}
            ],
            ruecken: [
                {n:"Superman", d:"Bauchlage. Strecke Arme nach vorne und Beine nach hinten. Hebe nun Arme und Beine gleichzeitig so hoch wie m√∂glich an. Sp√ºre den unteren R√ºcken. Kurz halten, dann senken."},
                {n:"Aquaman", d:"Wie Superman, aber du hebst abwechselnd linken Arm/rechtes Bein und rechten Arm/linkes Bein. Dynamische Bewegung f√ºr die R√ºckenstrecker."},
                {n:"Reverse Snow Angel", d:"Bauchlage, Arme seitlich am K√∂rper. Hebe den Oberk√∂rper leicht an. F√ºhre die gestreckten Arme in einem gro√üen Bogen √ºber den Kopf und wieder zur√ºck zur H√ºfte."},
                {n:"Bird Dog", d:"Vierf√º√ülerstand. Strecke den rechten Arm nach vorn und das linke Bein nach hinten. Mach dich lang. F√ºhre Ellbogen und Knie unter dem Bauch zusammen und strecke wieder. Seitenwechsel."},
                {n:"Prone W-Raise", d:"Bauchlage. Arme seitlich angewinkelt (wie ein 'W'). Hebe den Oberk√∂rper und ziehe die Schulterbl√§tter aktiv zusammen. Halten und senken."}
            ],
            stuhl: [
                {n:"Chair Dips", d:"Setz dich auf die Stuhlkante, H√§nde neben den Po. Rutsch mit dem Po vor den Stuhl. Beuge die Arme, senke den Po ab und dr√ºck dich wieder hoch. Ellbogen nach hinten!"},
                {n:"Bulgarian Split Squats", d:"Ein Fu√ü liegt mit dem Spann hinten auf dem Stuhl/Sofa auf. Das andere Bein steht weit vorn. Beuge das vordere Bein tief. Der Oberk√∂rper bleibt aufrecht. K√∂nigsklasse f√ºr Beine!"},
                {n:"Step-Ups", d:"Stell dich vor den Stuhl (muss stabil sein!). Steige mit einem Bein komplett hoch, richte dich ganz auf, und steig wieder ab. Wechsel das Bein. Blick geradeaus."},
                {n:"Incline Push-Ups", d:"H√§nde auf die Sitzfl√§che des Stuhls, F√º√üe am Boden. K√∂rper bildet eine Linie. Senke die Brust zur Stuhlkante. Einfacher als normale Liegest√ºtze, aber sehr effektiv."},
                {n:"Seated Knee Tucks", d:"Setz dich auf die Kante, lehn dich leicht zur√ºck, halt dich an der Sitzfl√§che fest. Zieh die Knie zur Brust und streck die Beine wieder aus, ohne den Boden zu ber√ºhren."}
            ],
            ganz: [
                 {n:"Burpees", d:"Der Fettkiller: Aus dem Stand in die Hocke, H√§nde auf den Boden, Sprung zur√ºck in den St√ºtz, (optional Liegest√ºtz), Sprung vor in die Hocke und Strecksprung nach oben."},
                 {n:"Mountain Climbers", d:"Liegest√ºtz-Position. Ziehe abwechselnd die Knie schnell und dynamisch unter den K√∂rper Richtung Brust. Der R√ºcken bleibt gerade, der Po tief."},
                 {n:"Jumping Jacks", d:"Hampelmann: Springe in den breiten Stand, H√§nde ber√ºhren sich √ºber dem Kopf. Springe zur√ºck, H√§nde an die Seite. Bleib auf den Fu√üballen. Finde einen schnellen Rhythmus."},
                 {n:"Squat Jumps", d:"Mache eine normale Kniebeuge, aber dr√ºcke dich explosiv ab und springe so hoch du kannst. Lande weich und gehe direkt in die n√§chste Beuge."},
                 {n:"Plank Jacks", d:"Unterarmst√ºtz. Springe mit den F√º√üen auseinander (wie beim Hampelmann) und wieder zusammen. Halte die H√ºfte dabei so stabil wie m√∂glich."}
            ],
            cardio: [
                {n:"High Knees", d:"Lauf auf der Stelle, aber zieh die Knie dabei so hoch wie m√∂glich (mindestens H√ºfth√∂he). Nimm die Arme dynamisch mit. Gib Gas!"},
                {n:"Skaters", d:"Springe seitlich von einem Bein auf das andere. Das freie Bein kreuzt hinten. Nimm den gegen√ºberliegenden Arm mit zum Boden. Wie beim Eisschnelllauf."},
                {n:"Butt Kicks", d:"Laufen am Platz, dabei die Fersen aktiv zum Po ziehen. Oberk√∂rper leicht vorgeneigt."},
                {n:"Jumping Lunges", d:"Gesprungene Ausfallschritte. Wechsle die Beine explosiv in der Luft. Nur f√ºr Fortgeschrittene!"},
                {n:"Fast Feet", d:"Steh schulterbreit, geh leicht in die Knie. Tippel so schnell du kannst auf der Stelle (nur Fu√üballen). Der Boden ist Lava!"}
            ]
        };

        // --- 2. GLOBAL STATE ---
        let app = { 
            profile: { h:0, w:0, a:0 }, 
            goal: '', 
            parts: [], 
            history: [], 
            logs: [], 
            settings: { 
                work: 40, 
                rest: 20, 
                weeklyGoal: 3, 
                duration: 10, 
                supps: true, 
                suppMsg: "",
                suppState: [false, false, false, false, false]
            }, 
            currentWorkout: [] 
        };
        
        let sess = { run: false, int: null, t: 0, idx: 0, r: 1, work: false, sound: true, preview: null, wasRunning: false };
        let wiz = { goal: '', parts: [] };
        let ac = null; 
        let sound = true;

        const circle = document.getElementById('progress-circle');
        const circumference = 2 * Math.PI * 115;
        circle.style.strokeDasharray = `${circumference} ${circumference}`;

        // --- 3. INIT & NAVIGATION ---
        window.onload = () => {
            const d = localStorage.getItem(STORE_KEY);
            if(d) { 
                app = JSON.parse(d); 
                initApp(); 
            } else { 
                document.getElementById('view-onboarding').style.display = 'flex'; 
            }
            renderLibrary();
        };

        function initApp() {
            document.getElementById('view-onboarding').style.display = 'none';
            document.getElementById('set-height').value = app.profile.h || '';
            document.getElementById('set-age').value = app.profile.a || '';
            document.getElementById('rng-goal').value = app.settings.weeklyGoal || 3;
            document.getElementById('rng-work').value = app.settings.work || 40;
            document.getElementById('rng-rest').value = app.settings.rest || 20;
            document.getElementById('tog-supps').checked = app.settings.supps !== false;
            document.getElementById('supp-live-msg').value = app.settings.suppMsg || "";

            restoreSupps();

            setWorkoutDuration(app.settings.duration || 10, document.getElementById('dur-' + (app.settings.duration || 10)));
            
            updateRangeLbl(); 
            updateUI(); 
            updateSettingsUI();
            
            const h = new Date().getHours();
            document.getElementById('greeting').innerText = h<10?"GUTEN MORGEN":(h<18?"TAG":"GUTEN ABEND");
        }

        function nav(id, el) { 
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
            document.getElementById(id).classList.add('active'); 
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); 
            el.classList.add('active'); 
            if(id === 'tab-library') renderLibrary();
        }

        // --- 4. CORE LOGIC ---
        function setWorkoutDuration(min, el) {
            app.settings.duration = min;
            ['dur-10', 'dur-20', 'dur-30'].forEach(id => {
                const btn = document.getElementById(id);
                btn.className = 'btn btn-outline'; 
                btn.style.background = 'transparent'; 
                btn.style.color = 'var(--primary)';
            });

            if(el) {
                el.className = 'btn'; 
                el.style.background = 'white'; 
                el.style.color = 'black';
            }
            
            generateWorkout(); 
            save();
        }

        function generateWorkout() {
            let pool = []; 
            let cat = (app.parts && app.parts.length > 0) ? app.parts : ['bauch','beine','ober','cardio'];
            cat.forEach(p => { if(DB[p]) pool = pool.concat(DB[p]); });
            
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }

            let count = app.settings.duration === 10 ? 6 : (app.settings.duration === 20 ? 10 : 14);
            app.currentWorkout = pool.slice(0, count);
        }

        // --- 5. UI UPDATES ---
        function updateUI() {
            const now = new Date();
            const startOfWeek = new Date(now); 
            startOfWeek.setDate(now.getDate() - (now.getDay() || 7) + 1); 
            startOfWeek.setHours(0,0,0,0);
            
            let thisWeekWorkouts = 0;
            let minsWeek = 0;
            let minsMonth = 0;
            let minsYear = 0;
            let totalMinsLifetime = 0;

            app.history.forEach(h => {
                const d = new Date(h.date);
                const dur = h.duration || (h.kcal ? Math.round(h.kcal / 8) : 10);
                totalMinsLifetime += dur;

                if(d >= startOfWeek) {
                    thisWeekWorkouts++;
                    minsWeek += dur;
                }
                if(d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
                    minsMonth += dur;
                }
                if(d.getFullYear() === now.getFullYear()) {
                    minsYear += dur;
                }
            });

            document.getElementById('min-week').innerText = minsWeek;
            document.getElementById('min-month').innerText = minsMonth;
            document.getElementById('min-year').innerText = minsYear;
            document.getElementById('lvl-badge').innerText = "LVL " + (1 + Math.floor(totalMinsLifetime / 60));

            const target = parseInt(app.settings.weeklyGoal);
            document.getElementById('week-val').innerText = `${thisWeekWorkouts} / ${target}`;
            const pct = Math.min(thisWeekWorkouts / target, 1);
            document.getElementById('week-circle').style.strokeDashoffset = 125 - (125 * pct);
            
            let totalKcal = 0; app.history.forEach(h => totalKcal += (h.kcal || 0));
            document.getElementById('disp-total-kcal').innerText = totalKcal.toLocaleString();

            if(app.profile.h && app.profile.w) { 
                const hM = app.profile.h / 100;
                const bmi = (app.profile.w / (hM * hM)).toFixed(1); 
                document.getElementById('disp-bmi').innerText = bmi; 
            } else {
                document.getElementById('disp-bmi').innerText = "-";
            }

            if(app.history.length > 0) {
                const last = new Date(app.history[app.history.length-1].date);
                document.getElementById('last-workout').innerText = "Letztes: " + last.toLocaleDateString();
            } else {
                document.getElementById('last-workout').innerText = "Neu hier?";
            }

            renderChart(); 
            renderHist();
        }

        function renderLibrary() {
            const container = document.getElementById('lib-list'); 
            container.innerHTML = "";
            
            for (let kat in DB) {
                const header = document.createElement('h2'); 
                header.innerText = kat.toUpperCase(); 
                header.style.marginTop = "25px"; 
                container.appendChild(header);
                
                DB[kat].forEach(ex => {
                    const item = document.createElement('div'); 
                    item.className = 'lib-item'; 
                    item.innerHTML = `<span>${ex.n}</span><span class="tag">${kat}</span>`;
                    item.onclick = () => { 
                        document.getElementById('info-title').innerText = ex.n; 
                        document.getElementById('info-desc').innerText = ex.d; 
                        document.getElementById('view-info').style.display = 'flex'; 
                    };
                    container.appendChild(item);
                });
            }
        }

        // --- 6. PLAYER LOGIC ---
        function openPlayer() { 
            if(app.currentWorkout.length === 0) generateWorkout();
            if(!ac) ac = new (window.AudioContext||window.webkitAudioContext)(); 
            sess.idx = 0; sess.r = 1; sess.t = 10; sess.work = false; 
            document.getElementById('view-player').style.display = 'flex'; 
            startPhase('PREP'); 
        }

        function startPhase(type) {
            sess.work = (type === 'WORK');
            
            if(type === 'PREP') { 
                sess.t = 10; 
                document.getElementById('phase-disp').innerText = "READY"; 
                sess.preview = app.currentWorkout[0]; 
                document.getElementById('ex-name').innerText = "Start: " + sess.preview.n;
            } else if(type === 'WORK') { 
                sess.t = parseInt(app.settings.work); 
                document.getElementById('phase-disp').innerText = "WORK"; 
                sess.preview = app.currentWorkout[sess.idx];
                document.getElementById('ex-name').innerText = sess.preview.n; 
                beep(400, 800); 
            } else { 
                sess.t = parseInt(app.settings.rest); 
                document.getElementById('phase-disp').innerText = "PAUSE"; 
                beep(600, 300); 
                
                let nextIdx = sess.idx + 1;
                if (nextIdx >= app.currentWorkout.length) nextIdx = 0;
                
                if (sess.idx >= app.currentWorkout.length - 1 && sess.r >= 3) {
                     document.getElementById('ex-name').innerText = "FAST GESCHAFFT!";
                     sess.preview = null;
                } else {
                     sess.preview = app.currentWorkout[nextIdx];
                     document.getElementById('ex-name').innerText = "N√ÑCHSTE: " + sess.preview.n;
                }
            }
            updatePlayerUI(); 
            if(!sess.run) toggleTimer();
        }

        function showInfoAndPause() {
            if (sess.preview) {
                document.getElementById('info-title').innerText = sess.preview.n; 
                document.getElementById('info-desc').innerText = sess.preview.d; 
                document.getElementById('view-info').style.display = 'flex'; 
                if(sess.run) {
                    toggleTimer(); 
                    sess.wasRunning = true; 
                } else {
                    sess.wasRunning = false;
                }
            }
        }

        function closeInfoAndResume() {
            document.getElementById('view-info').style.display = 'none';
            if(sess.wasRunning && !sess.run) {
                toggleTimer(); 
            }
        }

        function tick() { 
            if(sess.t > 0) { 
                sess.t--; 
                if(sess.t <= 3) beep(1000, 1000, 0.05); 
                updatePlayerUI(); 
            } else { 
                nextStep(); 
            } 
        }

        function nextStep() {
            if(document.getElementById('phase-disp').innerText === "READY") {
                startPhase('WORK');
            } else if(sess.work) { 
                if(sess.idx >= app.currentWorkout.length-1 && sess.r >= 3) { 
                    clearInterval(sess.int); 
                    document.getElementById('view-rpe').style.display='flex'; 
                } else {
                    startPhase('REST'); 
                }
            } else { 
                sess.idx++; 
                if(sess.idx >= app.currentWorkout.length) { 
                    sess.idx = 0; 
                    sess.r++; 
                } 
                document.getElementById('round-disp').innerText = "RUNDE "+sess.r+"/3"; 
                startPhase('WORK'); 
            }
        }

        function updatePlayerUI() { 
            document.getElementById('time-disp').innerText = sess.t; 
            const max = sess.work ? app.settings.work : (sess.idx===0&&sess.r===1?10:app.settings.rest); 
            circle.style.strokeDashoffset = circumference - (sess.t / max) * circumference; 
        }

        function toggleTimer() { 
            const b = document.getElementById('play-btn'); 
            if(sess.run) { 
                clearInterval(sess.int); sess.run = false; b.innerText="WEITER"; 
            } else { 
                sess.int = setInterval(tick, 1000); sess.run = true; b.innerText="STOP"; 
            } 
        }

        function finishWorkout() { 
            const dur = app.settings.duration;
            const kcalCalc = dur * 8; 
            
            app.history.push({
                date: new Date(), 
                kcal: kcalCalc,
                duration: dur 
            }); 
            
            save(); 
            updateUI();
            
            if (app.settings.supps !== false) {
                document.getElementById('view-rpe').style.display='none';
                document.getElementById('view-player').style.display='none';
                openSuppsManually();
                
                if(app.settings.suppMsg) {
                    const el = document.getElementById('supp-custom-msg');
                    el.innerText = app.settings.suppMsg;
                    el.style.display = 'block';
                }
            } else {
                location.reload(); 
            }
        }

        function openSuppsManually() {
            document.getElementById('view-supps').style.display='flex';
            restoreSupps(); 
        }

        function saveSuppMsg(el) {
            app.settings.suppMsg = el.value;
            save();
        }

        function toggleCheck(el, index) { 
            el.classList.toggle('checked');
            if(!app.settings.suppState) app.settings.suppState = [false, false, false, false, false];
            app.settings.suppState[index] = el.classList.contains('checked');
            save();
        }
        
        function restoreSupps() {
            if(!app.settings.suppState) return;
            const items = document.querySelectorAll('#check-list-container .check-item');
            app.settings.suppState.forEach((state, i) => {
                if(items[i]) {
                    if(state) items[i].classList.add('checked');
                    else items[i].classList.remove('checked');
                }
            });
        }

        function saveLog() { 
            let dVal = document.getElementById('log-date').value;
            if(!dVal) dVal = new Date().toISOString().split('T')[0];

            const w = document.getElementById('log-weight').value;
            if(!w) { alert("Bitte gib zumindest dein Gewicht ein!"); return; }

            app.profile.w = w; 
            
            app.logs.push({
                date: dVal, 
                w: w, 
                waist: document.getElementById('log-waist').value || 0, 
                hips: document.getElementById('log-hips').value || 0, 
                chest: document.getElementById('log-chest').value || 0, 
                thigh: document.getElementById('log-thigh').value || 0
            }); 
            
            app.logs.sort((a,b)=>new Date(a.date)-new Date(b.date));
            save(); 
            updateUI(); 
            alert("‚úÖ Werte erfolgreich gespeichert!");
        }

        function renderChart() { 
            const svg = document.getElementById('weight-chart'); 
            svg.innerHTML = ""; 
            if(app.logs.length < 2) return; 
            
            const data = app.logs.slice(-10).map(l => parseFloat(l.w)); 
            const max = Math.max(...data) + 1; 
            const min = Math.min(...data) - 1; 
            
            let p = ""; 
            data.forEach((v, i) => { 
                const x = i * (100 / (data.length - 1)); 
                const y = 100 - ((v - min) / (max - min) * 100); 
                p += `${x},${y} `; 
            }); 
            
            const pl = document.createElementNS("http://www.w3.org/2000/svg", "polyline"); 
            pl.setAttribute("points", p); 
            svg.appendChild(pl); 
        }

        function renderHist() { 
            const list = document.getElementById('hist-list'); 
            list.innerHTML = ""; 
            if(app.history.length === 0) {
                list.innerHTML = "<div style='color:#666; text-align:center; padding:20px;'>Noch keine Workouts.</div>";
                return;
            }
            app.history.slice(-10).reverse().forEach(h => {
                const k = h.kcal ? h.kcal : 0;
                const d = h.duration ? h.duration : Math.round(k/8); 
                list.innerHTML += `<div class="card" style="font-size:12px; margin-bottom:10px; padding:15px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>Workout (${d} min)</span>
                        <span style="color:var(--secondary)">${new Date(h.date).toLocaleDateString()} ‚Ä¢ ${k} kcal</span>
                    </div>
                </div>`; 
            }); 
        }

        function updateRangeLbl() { 
            app.settings.weeklyGoal = document.getElementById('rng-goal').value; 
            app.settings.work = document.getElementById('rng-work').value;
            app.settings.rest = document.getElementById('rng-rest').value;
            document.getElementById('lbl-goal').innerText = app.settings.weeklyGoal; 
            document.getElementById('lbl-work').innerText = app.settings.work;
            document.getElementById('lbl-rest').innerText = app.settings.rest;
            save(); updateUI(); 
        }

        function saveSettings() { 
            app.profile.h = document.getElementById('set-height').value; 
            app.profile.a = document.getElementById('set-age').value; 
            app.settings.suppMsg = document.getElementById('set-supp-msg').value;
            save(); updateUI(); 
        }

        function updateAppGoal(val) { app.goal = val; save(); updateSettingsUI(); }
        
        function updateAppPart(val) { 
            if(!app.parts) app.parts = []; 
            const i = app.parts.indexOf(val); 
            if(i > -1) app.parts.splice(i, 1); else app.parts.push(val); 
            save(); updateSettingsUI(); 
        }
        
        function toggleSuppsSetting() {
            app.settings.supps = document.getElementById('tog-supps').checked;
            save();
        }
        
        function updateSettingsUI() {
            document.querySelectorAll('#tab-settings .btn-outline').forEach(b => { 
                b.style.background="transparent"; b.style.color="var(--primary)"; 
            });
            const gBtn = document.getElementById('set-goal-' + app.goal); 
            if(gBtn) { gBtn.style.background="var(--primary)"; gBtn.style.color="var(--bg)"; }
            app.parts.forEach(p => { 
                const b = document.getElementById('set-part-' + p); 
                if(b) { b.style.background="var(--accent)"; b.style.color="black"; } 
            });
        }

        function wizSet(k,v,el) { 
            wiz[k]=v; 
            el.parentElement.querySelectorAll('div').forEach(d=>d.classList.remove('selected')); 
            el.classList.add('selected'); 
        }
        function wizToggle(k,v,el) { 
            if(!wiz[k]) wiz[k]=[]; 
            const i=wiz[k].indexOf(v); 
            if(i>-1) { wiz[k].splice(i,1); el.classList.remove('selected'); } 
            else { wiz[k].push(v); el.classList.add('selected'); } 
        }
        function wizNext(s) { 
            document.querySelectorAll('.wiz-step').forEach(ws=>ws.classList.remove('active')); 
            document.getElementById('wiz-'+(s+1)).classList.add('active'); 
        }
        function wizFinish() { 
            app.profile = { w: document.getElementById('wiz-weight').value, a: document.getElementById('wiz-age').value, h: document.getElementById('wiz-height').value }; 
            app.goal = wiz.goal; 
            app.parts = wiz.parts; 
            save(); initApp(); 
        }

        function beep(f1, f2, dur=0.2) { 
            if(!sound || !ac) return; 
            const o = ac.createOscillator(); 
            const g = ac.createGain(); 
            o.connect(g); g.connect(ac.destination); 
            o.type='sawtooth'; 
            o.frequency.setValueAtTime(f1, ac.currentTime); 
            o.frequency.exponentialRampToValueAtTime(f2, ac.currentTime+dur); 
            g.gain.setValueAtTime(0.05, ac.currentTime); 
            g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime+dur); 
            o.start(); o.stop(ac.currentTime+dur); 
        }
        
        function toggleMute() { 
            sound = !sound; 
            document.getElementById('mute-icon').innerText = sound ? "üîä" : "üîá"; 
        }

        function save() { localStorage.setItem(STORE_KEY, JSON.stringify(app)); }
        
        function exportData() { 
            const a = document.createElement('a'); 
            a.href = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(app)); 
            a.download = "backup.json"; 
            a.click(); 
        }
        
        function importData(el) { 
            const r = new FileReader(); 
            r.onload = e => { 
                app = JSON.parse(e.target.result); 
                save(); 
                location.reload(); 
            }; 
            r.readAsText(el.files[0]); 
        }
        
        function resetApp() { 
            if(confirm("ALLES L√ñSCHEN?")) { 
                localStorage.clear(); 
                location.reload(); 
            } 
        }
        
        function closePlayer() { clearInterval(sess.int); location.reload(); }
    </script>
</body>
</html>
